{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"tm2py-utils","text":"<p>Utilities and analysis tools for Travel Model Two (TM2)</p>"},{"location":"#overview","title":"Overview","text":"<p><code>tm2py-utils</code> provides a collection of utilities for working with Travel Model Two outputs, including:</p> <ul> <li>Validation Dashboard - Interactive web dashboard for model validation and scenario comparison</li> <li>Summary Generation - Automated summary statistics from CTRAMP model outputs</li> <li>PopulationSim Integration - Synthetic population analysis and validation</li> <li>Network Analysis - Tools for analyzing transportation networks</li> </ul>"},{"location":"#quick-start","title":"Quick Start","text":""},{"location":"#installation","title":"Installation","text":"<pre><code># Clone the repository\ngit clone https://github.com/BayAreaMetro/tm2py-utils.git\ncd tm2py-utils\n\n# Create conda environment\nconda env create -f environment.yml\nconda activate tm2py-utils\n\n# Install package\npip install -e .\n</code></pre>"},{"location":"#running-the-validation-dashboard","title":"Running the Validation Dashboard","text":"<pre><code># Navigate to validation directory\ncd tm2py_utils/summary/validation\n\n# Launch dashboard\nstreamlit run dashboard/dashboard_app.py --server.port 8501\n</code></pre> <p>Or use the deployment script:</p> <pre><code># Generate summaries and launch dashboard\npython run_and_deploy_dashboard.py --config validation_config.yaml --launch-dashboard\n</code></pre> <p>View the live dashboard: https://tm2-validation-dashboard.streamlit.app/</p>"},{"location":"#key-features","title":"Key Features","text":""},{"location":"#validation-dashboard","title":"\ud83d\udcca Validation Dashboard","text":"<p>Interactive web-based dashboard for comparing model runs and validating against observed data:</p> <ul> <li>Population - Synthetic population demographics (from PopulationSim)</li> <li>Households - Auto ownership patterns</li> <li>Activity Patterns - Daily activity patterns (CDAP)</li> <li>Tours - Tour frequency and mode choice</li> <li>Trips - Trip mode and purpose analysis</li> <li>Journey to Work - Commute patterns</li> <li>Time of Day - Temporal distribution of travel</li> <li>Trip Characteristics - Distance and travel time</li> </ul>"},{"location":"#summary-generation","title":"\ud83d\udd27 Summary Generation","text":"<p>Config-driven system for generating model validation summaries:</p> <ul> <li>Core Summaries (21) - Essential analysis matching legacy outputs</li> <li>Validation Summaries (13) - Extended analysis for dashboard</li> <li>Custom Summaries - Easy to add via YAML configuration</li> </ul> <pre><code># Generate all summaries\npython -m tm2py_utils.summary.validation.summaries.run_all --config validation_config.yaml\n\n# Generate only core summaries (fast)\n# Edit validation_config.yaml: generate_summaries: \"core\"\npython -m tm2py_utils.summary.validation.summaries.run_all --config validation_config.yaml\n</code></pre>"},{"location":"#populationsim-integration","title":"\ud83c\udfd8\ufe0f PopulationSim Integration","text":"<p>Analysis tools for synthetic population outputs:</p> <ul> <li>Household demographics (size, income, workers)</li> <li>Person demographics (age distribution)</li> <li>Geographic distribution by county</li> <li>Validation against ACS data</li> </ul>"},{"location":"#documentation","title":"Documentation","text":"<ul> <li>Installation Guide</li> <li>Dashboard Guide</li> <li>Summary System</li> <li>Contributing</li> <li>Consolidation Proposal - Plan to consolidate summary systems</li> </ul>"},{"location":"#architecture","title":"Architecture","text":"<pre><code>tm2py_utils/\n\u251c\u2500\u2500 summary/\n\u2502   \u251c\u2500\u2500 validation/              # Validation dashboard and summaries\n\u2502   \u2502   \u251c\u2500\u2500 dashboard/           # Dashboard YAML configs and app\n\u2502   \u2502   \u251c\u2500\u2500 summaries/           # Summary generation scripts\n\u2502   \u2502   \u251c\u2500\u2500 data_model/          # Data model definitions\n\u2502   \u2502   \u251c\u2500\u2500 outputs/             # Generated summary CSVs\n\u2502   \u2502   \u2514\u2500\u2500 validation_config.yaml\n\u2502   \u2514\u2500\u2500 core_summaries/          # Legacy summary system (being deprecated)\n\u251c\u2500\u2500 inputs/                      # Input data preparation tools\n\u251c\u2500\u2500 requests/                    # Special analysis requests\n\u2514\u2500\u2500 docs/                        # Documentation (this site)\n</code></pre>"},{"location":"#related-projects","title":"Related Projects","text":"<ul> <li>tm2py - Main Travel Model Two implementation</li> <li>PopulationSim - Synthetic population generator</li> <li>Bay Area UrbanSim - Land use model</li> </ul>"},{"location":"#support","title":"Support","text":"<ul> <li>Issues: GitHub Issues</li> <li>Discussions: GitHub Discussions</li> <li>MTC Contact: modeling@bayareametro.gov</li> </ul>"},{"location":"#license","title":"License","text":"<p>This project is licensed under the Apache License 2.0 - see the LICENSE file for details.</p>"},{"location":"configuration/","title":"Configuration Reference","text":"<p>Complete reference for <code>validation_config.yaml</code> and related configuration files.</p>"},{"location":"configuration/#validation_configyaml","title":"validation_config.yaml","text":"<p>Main configuration file for summary generation and dashboard deployment.</p>"},{"location":"configuration/#top-level-settings","title":"Top-Level Settings","text":"<pre><code># Summary generation filter: \"all\", \"core\", or \"validation\"\ngenerate_summaries: \"all\"\n\n# Base directories for input data\ninput_directories:\n  - path: \"/path/to/model/run/outputs\"\n    label: \"2023 TM2.2 v05\"\n  - path: \"/path/to/another/run\"\n    label: \"2015 TM2.2 Sprint 04\"\n\n# Output directory for generated summaries\noutput_directory: \"outputs\"\n\n# Observed data for validation\nobserved_data_sources:\n  - name: \"ACS 2019\"\n    directory: \"/path/to/observed/data\"\n    files:\n      auto_ownership: \"acs_auto_ownership.csv\"\n      household_size: \"acs_household_size.csv\"\n\n# Custom summary definitions\ncustom_summaries:\n  - name: \"my_summary\"\n    # ... (see Custom Summaries section)\n</code></pre>"},{"location":"configuration/#input-directories","title":"Input Directories","text":"<p>Each entry requires:</p> <pre><code>input_directories:\n  - path: \"/absolute/path/to/outputs\"  # Absolute path to CTRAMP outputs\n    label: \"Dataset Name\"               # Display name in charts\n</code></pre> <p>Expected files in directory: - <code>householdData_1.csv</code> - <code>personData_1.csv</code> - <code>indivTourData_1.csv</code> - <code>indivTripData_1.csv</code> - <code>wsLocResults.csv</code></p>"},{"location":"configuration/#custom-summaries","title":"Custom Summaries","text":""},{"location":"configuration/#required-fields","title":"Required Fields","text":"<pre><code>custom_summaries:\n  - name: \"summary_identifier\"          # Unique name (becomes filename)\n    summary_type: \"core\"                # \"core\" or \"validation\"\n    description: \"What this summarizes\" # Human-readable description\n    data_source: \"individual_trips\"     # Data source (see below)\n</code></pre>"},{"location":"configuration/#data-sources","title":"Data Sources","text":"<p>Available options:</p> <ul> <li><code>households</code> - Household-level data</li> <li><code>persons</code> - Person-level data</li> <li><code>individual_tours</code> - Tour-level data</li> <li><code>individual_trips</code> - Trip-level data</li> <li><code>workplace_school</code> - Work/school location choice</li> <li><code>synthetic_population</code> - PopulationSim output</li> </ul>"},{"location":"configuration/#basic-grouping","title":"Basic Grouping","text":"<p>Single column: <pre><code>group_by: \"trip_mode\"\ncount_name: \"trips\"  # Column name for counts\n</code></pre></p> <p>Multiple columns: <pre><code>group_by: [\"income_category_bin\", \"trip_mode\"]\ncount_name: \"trips\"\n</code></pre></p>"},{"location":"configuration/#aggregations","title":"Aggregations","text":"<p>Simple count: <pre><code>count_name: \"trips\"\n</code></pre></p> <p>Multiple aggregations: <pre><code>aggregations:\n  trips: \"count\"                                    # Count rows\n  avg_distance:                                     # Mean\n    column: \"trip_distance_miles\"\n    agg: \"mean\"\n  total_time:                                       # Sum\n    column: \"trip_time_minutes\"\n    agg: \"sum\"\n  max_distance:                                     # Max\n    column: \"trip_distance_miles\"\n    agg: \"max\"\n  min_distance:                                     # Min\n    column: \"trip_distance_miles\"\n    agg: \"min\"\n</code></pre></p> <p>Available aggregation functions: - <code>count</code> - Count rows - <code>mean</code> - Average - <code>sum</code> - Total - <code>max</code> - Maximum value - <code>min</code> - Minimum value - <code>median</code> - Median value - <code>std</code> - Standard deviation</p>"},{"location":"configuration/#share-calculations","title":"Share Calculations","text":"<p>Calculate percentages within groups:</p> <pre><code>group_by: [\"tour_purpose\", \"tour_mode\"]\nshare_within: \"tour_purpose\"  # Each purpose sums to 100%\n</code></pre> <p>Without <code>share_within</code>, shares calculated across all rows.</p>"},{"location":"configuration/#weighting","title":"Weighting","text":"<p>Apply sample expansion factors:</p> <pre><code>weight_field: \"sample_rate\"  # Column containing weights\n</code></pre>"},{"location":"configuration/#binning","title":"Binning","text":"<p>Discretize continuous variables:</p> <pre><code>group_by: [\"income_bin\", \"auto_ownership\"]\nbins:\n  income:\n    breaks: [0, 30000, 60000, 100000, 150000, 1000000000]\n    labels: ['&lt;30K', '30-60K', '60-100K', '100-150K', '150K+']\n\n  distance:\n    breaks: [0, 5, 10, 20, 50, 1000]\n    labels: ['&lt;5mi', '5-10mi', '10-20mi', '20-50mi', '50+mi']\n</code></pre> <p>Note: Column name in <code>group_by</code> must match bin name (e.g., <code>income_bin</code> references <code>income</code> bin definition).</p>"},{"location":"configuration/#filtering","title":"Filtering","text":"<p>Apply filters before aggregation:</p> <pre><code>filters:\n  tour_purpose: [\"Work\", \"School\"]    # Include only these values\n  trip_distance_miles: {\"&gt;\": 0}       # Distance greater than 0\n</code></pre> <p>Available operators: - <code>[\"value1\", \"value2\"]</code> - Equals any of these - <code>{\"&gt;\": value}</code> - Greater than - <code>{\"&lt;\": value}</code> - Less than - <code>{\"&gt;=\": value}</code> - Greater than or equal - <code>{\"&lt;=\": value}</code> - Less than or equal</p>"},{"location":"configuration/#observed-data","title":"Observed Data","text":"<p>Compare to validation data:</p> <pre><code>observed_data: \"ACS 2019\"      # Name from observed_data_sources\nobserved_file: \"auto_ownership\" # File key from observed_data_sources\n</code></pre> <p>Observed data merged into output with <code>dataset</code> = observed data name.</p>"},{"location":"configuration/#complete-summary-example","title":"Complete Summary Example","text":"<pre><code>custom_summaries:\n  - name: \"trip_distance_by_mode_income\"\n    summary_type: \"validation\"\n    description: \"Trip distance distribution by mode and income category\"\n    data_source: \"individual_trips\"\n    group_by: [\"distance_bin\", \"trip_mode\", \"income_bin\"]\n    weight_field: \"sample_rate\"\n    aggregations:\n      trips: \"count\"\n      avg_distance:\n        column: \"trip_distance_miles\"\n        agg: \"mean\"\n    bins:\n      distance:\n        breaks: [0, 5, 10, 20, 50, 1000]\n        labels: ['&lt;5mi', '5-10mi', '10-20mi', '20-50mi', '50+mi']\n      income:\n        breaks: [0, 30000, 60000, 100000, 150000, 1000000000]\n        labels: ['&lt;30K', '30-60K', '60-100K', '100-150K', '150K+']\n    filters:\n      trip_distance_miles: {\"&gt;\": 0}\n    share_within: \"income_bin\"\n</code></pre>"},{"location":"configuration/#ctramp_data_modelyaml","title":"ctramp_data_model.yaml","text":"<p>Maps CTRAMP output file columns to standardized names.</p>"},{"location":"configuration/#structure","title":"Structure","text":"<pre><code>data_source_name:\n  file_pattern: \"fileName_{iteration}.csv\"  # {iteration} replaced with run iteration\n  columns:\n    standard_name: \"ctramp_column_name\"\n</code></pre>"},{"location":"configuration/#example","title":"Example","text":"<pre><code>individual_trips:\n  file_pattern: \"indivTripData_{iteration}.csv\"\n  columns:\n    trip_mode: \"trip_mode\"\n    tour_purpose: \"tour_purpose\"\n    trip_distance_miles: \"trip_distance\"\n    depart_period: \"depart_period\"\n    trip_time_minutes: \"travelTime\"\n    sample_rate: \"sampleRate\"\n\nhouseholds:\n  file_pattern: \"householdData_{iteration}.csv\"\n  columns:\n    household_id: \"hh_id\"\n    income: \"income\"\n    auto_ownership: \"autos\"\n    household_size: \"size\"\n    county: \"county\"\n</code></pre>"},{"location":"configuration/#adding-new-mappings","title":"Adding New Mappings","text":"<ol> <li>Identify CTRAMP output file and column names</li> <li>Add to appropriate data source or create new section</li> <li>Use in <code>validation_config.yaml</code> summaries</li> </ol>"},{"location":"configuration/#variable_labelsyaml","title":"variable_labels.yaml","text":"<p>Human-readable labels for variables used in charts.</p>"},{"location":"configuration/#structure_1","title":"Structure","text":"<pre><code>column_name: \"Display Label\"\n</code></pre>"},{"location":"configuration/#example_1","title":"Example","text":"<pre><code># Mode\ntrip_mode: \"Trip Mode\"\ntour_mode: \"Tour Mode\"\n\n# Purpose\ntour_purpose: \"Tour Purpose\"\ntrip_purpose: \"Trip Purpose\"\n\n# Geography\ncounty: \"County\"\ntaz: \"TAZ\"\n\n# Household\nincome_category_bin: \"Income Category\"\nauto_ownership: \"Autos Owned\"\nhousehold_size: \"Household Size\"\n\n# Time\ndepart_period: \"Departure Period\"\narrive_period: \"Arrival Period\"\n\n# Distance/Time\ntrip_distance_miles: \"Distance (miles)\"\ntrip_time_minutes: \"Travel Time (minutes)\"\n</code></pre> <p>Labels automatically applied in dashboard charts.</p>"},{"location":"configuration/#dashboard-yaml-files","title":"Dashboard YAML Files","text":"<p>Located in <code>dashboard/</code> directory. Named <code>dashboard-N-title.yaml</code>.</p>"},{"location":"configuration/#structure_2","title":"Structure","text":"<pre><code>title: \"Tab Title\"\ndescription: \"Tab description shown at top\"\n\nsections:\n  - title: \"Section Name\"\n    layout: \"two_column\"  # single_column, two_column, three_column\n    charts:\n      - type: \"bar\"\n        title: \"Chart Title\"\n        # ... chart config\n\n      - type: \"line\"\n        title: \"Another Chart\"\n        # ... chart config\n</code></pre>"},{"location":"configuration/#chart-types","title":"Chart Types","text":""},{"location":"configuration/#bar-chart","title":"Bar Chart","text":"<pre><code>- type: \"bar\"\n  title: \"Trips by Mode\"\n  data_file: \"trip_mode_choice.csv\"\n  x: \"trip_mode\"\n  y: \"trips\"\n  color: \"dataset\"\n  orientation: \"h\"  # \"h\" or \"v\"\n  barmode: \"group\"  # \"group\", \"stack\", \"relative\"\n</code></pre>"},{"location":"configuration/#line-chart","title":"Line Chart","text":"<pre><code>- type: \"line\"\n  title: \"Mode Share Trend\"\n  data_file: \"mode_share_trend.csv\"\n  x: \"year\"\n  y: \"share\"\n  color: \"trip_mode\"\n</code></pre>"},{"location":"configuration/#scatter-plot","title":"Scatter Plot","text":"<pre><code>- type: \"scatter\"\n  title: \"Distance vs Time\"\n  data_file: \"trip_characteristics.csv\"\n  x: \"trip_distance_miles\"\n  y: \"trip_time_minutes\"\n  color: \"trip_mode\"\n</code></pre>"},{"location":"configuration/#box-plot","title":"Box Plot","text":"<pre><code>- type: \"box\"\n  title: \"Distance Distribution\"\n  data_file: \"trip_distance.csv\"\n  x: \"trip_mode\"\n  y: \"trip_distance_miles\"\n  color: \"dataset\"\n</code></pre>"},{"location":"configuration/#histogram","title":"Histogram","text":"<pre><code>- type: \"histogram\"\n  title: \"Trip Distance Distribution\"\n  data_file: \"trip_distance.csv\"\n  x: \"trip_distance_miles\"\n  nbins: 50\n</code></pre>"},{"location":"configuration/#chart-options","title":"Chart Options","text":""},{"location":"configuration/#faceting","title":"Faceting","text":"<p>Create subplots by category:</p> <pre><code>facet_col: \"county\"        # Create subplot for each county\nfacet_col_wrap: 2          # Number of columns\n</code></pre>"},{"location":"configuration/#category-ordering","title":"Category Ordering","text":"<p>Control order of categories:</p> <pre><code>category_orders:\n  trip_mode: [\"Walk\", \"Bike\", \"Transit\", \"Drive Alone\", \"Carpool\"]\n  income_category_bin: ['&lt;30K', '30-60K', '60-100K', '100-150K', '150K+']\n</code></pre>"},{"location":"configuration/#custom-labels","title":"Custom Labels","text":"<p>Override axis labels:</p> <pre><code>labels:\n  trip_mode: \"Travel Mode\"\n  trips: \"Number of Trips\"\n  share: \"Share (%)\"\n</code></pre>"},{"location":"configuration/#complete-chart-example","title":"Complete Chart Example","text":"<pre><code>- type: \"bar\"\n  title: \"Mode Choice by Income Category\"\n  data_file: \"trip_mode_by_income.csv\"\n  x: \"trip_mode\"\n  y: \"share\"\n  color: \"dataset\"\n  orientation: \"h\"\n  barmode: \"group\"\n  facet_col: \"income_category_bin\"\n  facet_col_wrap: 3\n  category_orders:\n    trip_mode: [\"Walk\", \"Bike\", \"Transit\", \"Drive Alone\", \"Carpool\"]\n    income_category_bin: ['&lt;30K', '30-60K', '60-100K', '100-150K', '150K+']\n  labels:\n    trip_mode: \"Travel Mode\"\n    share: \"Mode Share (%)\"\n</code></pre>"},{"location":"configuration/#environment-variables","title":"Environment Variables","text":"<p>Optional environment variables:</p> <pre><code># Dashboard port\nexport STREAMLIT_SERVER_PORT=8501\n\n# Data directory override\nexport TM2PY_UTILS_DATA_DIR=\"/path/to/data\"\n\n# Log level\nexport TM2PY_UTILS_LOG_LEVEL=\"DEBUG\"  # DEBUG, INFO, WARNING, ERROR\n</code></pre>"},{"location":"configuration/#file-locations","title":"File Locations","text":"<pre><code>tm2py_utils/summary/validation/\n\u251c\u2500\u2500 validation_config.yaml          # Main config\n\u251c\u2500\u2500 data_model/\n\u2502   \u251c\u2500\u2500 ctramp_data_model.yaml     # Column mappings\n\u2502   \u2514\u2500\u2500 variable_labels.yaml       # Display labels\n\u251c\u2500\u2500 dashboard/\n\u2502   \u251c\u2500\u2500 dashboard-0-population.yaml\n\u2502   \u251c\u2500\u2500 dashboard-1-households.yaml\n\u2502   \u2514\u2500\u2500 ...                         # Dashboard tab configs\n\u251c\u2500\u2500 outputs/                        # Generated summaries\n\u2502   \u251c\u2500\u2500 auto_ownership_regional.csv\n\u2502   \u251c\u2500\u2500 trip_mode_choice.csv\n\u2502   \u2514\u2500\u2500 dashboard/                  # Copied for dashboard\n\u2502       \u251c\u2500\u2500 auto_ownership_regional.csv\n\u2502       \u2514\u2500\u2500 ...\n\u2514\u2500\u2500 summaries/\n    \u251c\u2500\u2500 run_all.py                  # Main runner\n    \u2514\u2500\u2500 custom.py                   # Custom summary logic\n</code></pre>"},{"location":"configuration/#validation","title":"Validation","text":"<p>Check configuration validity:</p> <pre><code>cd tm2py_utils/summary/validation\n\n# List configured summaries\npython list_summaries.py\n\n# Test generation (dry run)\npython -m tm2py_utils.summary.validation.summaries.run_all \\\n  --config validation_config.yaml --dry-run\n\n# Generate single summary for testing\npython -m tm2py_utils.summary.validation.summaries.run_all \\\n  --config validation_config.yaml --summary-name trip_mode_choice\n</code></pre>"},{"location":"configuration/#common-configurations","title":"Common Configurations","text":""},{"location":"configuration/#core-vs-validation-filter","title":"Core vs Validation Filter","text":"<pre><code># Generate only core summaries (fast)\ngenerate_summaries: \"core\"\n\n# Generate only validation summaries\ngenerate_summaries: \"validation\"\n\n# Generate all summaries\ngenerate_summaries: \"all\"\n</code></pre>"},{"location":"configuration/#multiple-model-runs","title":"Multiple Model Runs","text":"<pre><code>input_directories:\n  - path: \"/model/runs/2015_base\"\n    label: \"2015 Base Year\"\n\n  - path: \"/model/runs/2023_v05\"\n    label: \"2023 TM2.2 v05\"\n\n  - path: \"/model/runs/2023_v06_draft\"\n    label: \"2023 TM2.2 v06 (draft)\"\n</code></pre> <p>All runs compared side-by-side in dashboard.</p>"},{"location":"configuration/#custom-output-location","title":"Custom Output Location","text":"<pre><code>output_directory: \"/shared/validation/outputs\"\n</code></pre>"},{"location":"configuration/#see-also","title":"See Also","text":"<ul> <li>Summary System Guide</li> <li>Dashboard Guide</li> <li>Contributing Guide</li> </ul>"},{"location":"contributing/","title":"Contributing to tm2py-utils","text":"<p>Thank you for contributing to tm2py-utils! This guide helps you add summaries, dashboard visualizations, and other features.</p>"},{"location":"contributing/#development-setup","title":"Development Setup","text":""},{"location":"contributing/#prerequisites","title":"Prerequisites","text":"<ul> <li>Python 3.9+</li> <li>Conda or virtualenv</li> <li>Git</li> </ul>"},{"location":"contributing/#installation","title":"Installation","text":"<pre><code># Clone repository\ngit clone https://github.com/BayAreaMetro/tm2py-utils.git\ncd tm2py-utils\n\n# Create environment\nconda env create -f environment.yml\nconda activate tm2py_utils\n\n# Install in development mode\npip install -e .\n\n# Install development dependencies\npip install pytest black flake8 mypy\n</code></pre>"},{"location":"contributing/#project-structure","title":"Project Structure","text":"<pre><code>tm2py_utils/\n\u251c\u2500\u2500 summary/\n\u2502   \u251c\u2500\u2500 validation/\n\u2502   \u2502   \u251c\u2500\u2500 summaries/           # Summary generation\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 run_all.py       # Main runner\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 custom.py        # Custom summary logic\n\u2502   \u2502   \u251c\u2500\u2500 dashboard/           # Dashboard YAML configs\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 dashboard-0-population.yaml\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 dashboard-1-households.yaml\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 ...\n\u2502   \u2502   \u251c\u2500\u2500 data_model/          # Column mappings\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 ctramp_data_model.yaml\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 variable_labels.yaml\n\u2502   \u2502   \u251c\u2500\u2500 validation_config.yaml\n\u2502   \u2502   \u2514\u2500\u2500 run_and_deploy_dashboard.py\n\u2502   \u2514\u2500\u2500 core_summaries/          # DEPRECATED - Use validation/ instead\n\u251c\u2500\u2500 inputs/                      # Input data processing\n\u251c\u2500\u2500 misc/                        # Utilities\n\u2514\u2500\u2500 docs/                        # Documentation\n</code></pre>"},{"location":"contributing/#adding-a-new-summary","title":"Adding a New Summary","text":""},{"location":"contributing/#1-define-in-configuration","title":"1. Define in Configuration","text":"<p>Edit <code>validation_config.yaml</code>:</p> <pre><code>custom_summaries:\n  - name: \"trip_length_by_mode_purpose\"\n    summary_type: \"validation\"  # or \"core\"\n    description: \"Trip distance by mode and purpose\"\n    data_source: \"individual_trips\"\n    group_by: [\"trip_mode\", \"tour_purpose\"]\n    weight_field: \"sample_rate\"\n    aggregations:\n      trips: \"count\"\n      avg_distance:\n        column: \"trip_distance_miles\"\n        agg: \"mean\"\n    share_within: \"tour_purpose\"\n</code></pre>"},{"location":"contributing/#2-test-generation","title":"2. Test Generation","text":"<pre><code>cd tm2py_utils/summary/validation\n\n# Check summary appears in list\npython list_summaries.py | grep trip_length_by_mode_purpose\n\n# Generate just your summary\npython -m tm2py_utils.summary.validation.summaries.run_all \\\n  --config validation_config.yaml\n</code></pre>"},{"location":"contributing/#3-verify-output","title":"3. Verify Output","text":"<p>Check output file: <pre><code>cat outputs/trip_length_by_mode_purpose.csv\n</code></pre></p> <p>Expected format: <pre><code>trip_mode,tour_purpose,trips,avg_distance,share,dataset\nDrive Alone,Work,150000,12.5,45.2,2023 TM2.2 v05\n...\n</code></pre></p>"},{"location":"contributing/#4-update-documentation","title":"4. Update Documentation","text":"<p>Add to appropriate section in <code>docs/summaries.md</code>.</p>"},{"location":"contributing/#adding-a-dashboard-tab","title":"Adding a Dashboard Tab","text":""},{"location":"contributing/#1-create-yaml-configuration","title":"1. Create YAML Configuration","text":"<p>Create <code>dashboard/dashboard-N-mytab.yaml</code>:</p> <pre><code>title: \"My New Analysis\"\ndescription: \"Description of what this tab shows\"\n\nsections:\n  - title: \"Overview\"\n    layout: \"two_column\"\n    charts:\n      - type: \"bar\"\n        title: \"My Metric by Category\"\n        data_file: \"my_summary.csv\"\n        x: \"category\"\n        y: \"value\"\n        color: \"dataset\"\n        orientation: \"h\"\n        facet_col: null\n\n      - type: \"line\"\n        title: \"Trend Over Time\"\n        data_file: \"my_trend.csv\"\n        x: \"year\"\n        y: \"value\"\n        color: \"category\"\n</code></pre>"},{"location":"contributing/#2-generate-required-data","title":"2. Generate Required Data","text":"<p>Ensure summaries in YAML exist in <code>validation_config.yaml</code>:</p> <pre><code>custom_summaries:\n  - name: \"my_summary\"\n    # ... configuration\n\n  - name: \"my_trend\"\n    # ... configuration\n</code></pre>"},{"location":"contributing/#3-test-dashboard","title":"3. Test Dashboard","text":"<pre><code>cd tm2py_utils/summary/validation\n\n# Generate summaries\npython run_and_deploy_dashboard.py --config validation_config.yaml\n\n# Launch dashboard\nstreamlit run dashboard/dashboard_app.py --server.port 8501\n</code></pre> <p>Visit http://localhost:8501 and check new tab appears.</p>"},{"location":"contributing/#4-dashboard-yaml-reference","title":"4. Dashboard YAML Reference","text":"<p>Chart Types: - <code>bar</code> - Bar chart (vertical or horizontal) - <code>line</code> - Line chart - <code>scatter</code> - Scatter plot - <code>box</code> - Box plot - <code>histogram</code> - Histogram</p> <p>Layout Options: - <code>single_column</code> - One chart per row - <code>two_column</code> - Two charts per row - <code>three_column</code> - Three charts per row</p> <p>Chart Properties: <pre><code>- type: \"bar\"\n  title: \"Chart Title\"\n  data_file: \"summary.csv\"        # CSV filename (must exist in outputs/dashboard/)\n  x: \"category_column\"            # X-axis column\n  y: \"value_column\"               # Y-axis column\n  color: \"dataset\"                # Color by column\n  orientation: \"h\"                # \"h\" or \"v\"\n  facet_col: \"another_category\"   # Create subplots by column\n  facet_col_wrap: 3               # Number of facet columns\n  barmode: \"group\"                # \"group\", \"stack\", or \"relative\"\n  category_orders:                # Custom ordering\n    category_column: [\"A\", \"B\", \"C\"]\n  labels:                         # Custom axis labels\n    category_column: \"Category\"\n    value_column: \"Count\"\n</code></pre></p>"},{"location":"contributing/#adding-a-column-mapping","title":"Adding a Column Mapping","text":"<p>If using new CTRAMP output columns:</p>"},{"location":"contributing/#1-update-data-model","title":"1. Update Data Model","text":"<p>Edit <code>data_model/ctramp_data_model.yaml</code>:</p> <pre><code>individual_trips:\n  file_pattern: \"indivTripData_{iteration}.csv\"\n  columns:\n    trip_mode: \"trip_mode\"\n    my_new_column: \"my_new_column\"  # Add mapping\n</code></pre>"},{"location":"contributing/#2-add-variable-label","title":"2. Add Variable Label","text":"<p>Edit <code>variable_labels.yaml</code>:</p> <pre><code>my_new_column: \"My New Column Label\"\n</code></pre>"},{"location":"contributing/#3-use-in-summary","title":"3. Use in Summary","text":"<pre><code>custom_summaries:\n  - name: \"summary_with_new_column\"\n    group_by: [\"my_new_column\"]\n    # ...\n</code></pre>"},{"location":"contributing/#code-style","title":"Code Style","text":""},{"location":"contributing/#python","title":"Python","text":"<p>Follow PEP 8:</p> <pre><code># Format code\nblack tm2py_utils/\n\n# Check style\nflake8 tm2py_utils/\n\n# Type checking\nmypy tm2py_utils/\n</code></pre>"},{"location":"contributing/#yaml","title":"YAML","text":"<ul> <li>Use 2-space indentation</li> <li>Quote strings with special characters</li> <li>Comment complex sections</li> </ul> <pre><code># Good\ncustom_summaries:\n  - name: \"my_summary\"\n    description: \"Clear description\"\n    group_by: [\"column1\", \"column2\"]\n\n# Avoid\ncustom_summaries:\n    - name: my_summary  # Missing quotes, 4-space indent\n      group_by: [column1]\n</code></pre>"},{"location":"contributing/#testing","title":"Testing","text":""},{"location":"contributing/#run-existing-tests","title":"Run Existing Tests","text":"<pre><code># All tests\npytest\n\n# Specific test\npytest tm2py_utils/summary/validation/test_summaries.py\n\n# With coverage\npytest --cov=tm2py_utils\n</code></pre>"},{"location":"contributing/#write-new-tests","title":"Write New Tests","text":"<p>Create <code>test_my_feature.py</code>:</p> <pre><code>import pytest\nfrom tm2py_utils.summary.validation import run_all\n\ndef test_my_summary_generation():\n    \"\"\"Test that my_summary generates expected output.\"\"\"\n    # Setup\n    config_path = \"test_config.yaml\"\n\n    # Run\n    run_all.main(config_path)\n\n    # Assert\n    output_file = \"outputs/my_summary.csv\"\n    assert output_file.exists()\n    # ... more assertions\n</code></pre>"},{"location":"contributing/#documentation","title":"Documentation","text":""},{"location":"contributing/#update-docs","title":"Update Docs","text":"<p>When adding features, update relevant documentation:</p> <ul> <li><code>docs/summaries.md</code> - For new summaries or configuration options</li> <li><code>docs/dashboard.md</code> - For new dashboard tabs or features</li> <li><code>docs/configuration.md</code> - For new config parameters</li> <li><code>README.md</code> - For major features</li> </ul>"},{"location":"contributing/#build-docs-locally","title":"Build Docs Locally","text":"<pre><code># Install mkdocs\npip install mkdocs mkdocs-material\n\n# Serve locally\ncd tm2py_utils\nmkdocs serve\n\n# Visit http://localhost:8000\n</code></pre>"},{"location":"contributing/#submitting-changes","title":"Submitting Changes","text":""},{"location":"contributing/#1-create-branch","title":"1. Create Branch","text":"<pre><code>git checkout -b feature/my-new-feature\n</code></pre>"},{"location":"contributing/#2-make-changes","title":"2. Make Changes","text":"<ul> <li>Add summaries to <code>validation_config.yaml</code></li> <li>Create dashboard YAML files</li> <li>Update documentation</li> </ul>"},{"location":"contributing/#3-test-changes","title":"3. Test Changes","text":"<pre><code># Run tests\npytest\n\n# Generate summaries\npython run_and_deploy_dashboard.py --config validation_config.yaml\n\n# Test dashboard\nstreamlit run dashboard/dashboard_app.py\n</code></pre>"},{"location":"contributing/#4-commit","title":"4. Commit","text":"<pre><code>git add .\ngit commit -m \"Add trip length analysis dashboard\n\n- Add trip_length_by_mode_purpose summary\n- Create dashboard-8-trip-length.yaml\n- Update summaries.md documentation\"\n</code></pre>"},{"location":"contributing/#5-push-and-create-pr","title":"5. Push and Create PR","text":"<pre><code>git push origin feature/my-new-feature\n</code></pre> <p>Then create Pull Request on GitHub.</p>"},{"location":"contributing/#common-patterns","title":"Common Patterns","text":""},{"location":"contributing/#binning-continuous-variables","title":"Binning Continuous Variables","text":"<pre><code>custom_summaries:\n  - name: \"trips_by_distance_bin\"\n    group_by: [\"distance_bin\", \"trip_mode\"]\n    bins:\n      distance:\n        breaks: [0, 5, 10, 20, 50, 1000]\n        labels: ['&lt;5mi', '5-10mi', '10-20mi', '20-50mi', '50+mi']\n</code></pre>"},{"location":"contributing/#multiple-aggregations","title":"Multiple Aggregations","text":"<pre><code>custom_summaries:\n  - name: \"trip_stats_by_mode\"\n    group_by: [\"trip_mode\"]\n    aggregations:\n      trips: \"count\"\n      avg_distance: {\"column\": \"trip_distance_miles\", \"agg\": \"mean\"}\n      total_time: {\"column\": \"trip_time_minutes\", \"agg\": \"sum\"}\n      max_distance: {\"column\": \"trip_distance_miles\", \"agg\": \"max\"}\n</code></pre>"},{"location":"contributing/#conditional-filters","title":"Conditional Filters","text":"<pre><code>custom_summaries:\n  - name: \"work_tours_only\"\n    data_source: \"individual_tours\"\n    filters:\n      tour_purpose: [\"Work\"]\n    group_by: [\"tour_mode\"]\n</code></pre>"},{"location":"contributing/#comparison-to-observed-data","title":"Comparison to Observed Data","text":"<p>Add to <code>observed_data_sources</code> in config:</p> <pre><code>observed_data_sources:\n  - name: \"ACS 2019\"\n    directory: \"/path/to/acs/data\"\n    files:\n      auto_ownership: \"acs_auto_ownership.csv\"\n</code></pre> <p>Then reference in summary:</p> <pre><code>custom_summaries:\n  - name: \"auto_ownership_regional\"\n    observed_data: \"ACS 2019\"\n    observed_file: \"auto_ownership\"\n</code></pre>"},{"location":"contributing/#getting-help","title":"Getting Help","text":"<ul> <li>Documentation: Check docs/</li> <li>Examples: See <code>examples/</code> directory</li> <li>Issues: Open on GitHub</li> <li>Email: modeling@bayareametro.gov</li> </ul>"},{"location":"contributing/#related-resources","title":"Related Resources","text":"<ul> <li>Consolidation Proposal - System architecture</li> <li>Dashboard Deployment Guide - Deployment workflow</li> <li>validation_config.yaml - Live configuration example</li> </ul>"},{"location":"dashboard/","title":"Dashboard Guide","text":"<p>The tm2py-utils validation dashboard is an interactive web application for comparing model runs and validating outputs against observed data.</p>"},{"location":"dashboard/#live-dashboard","title":"Live Dashboard","text":"<p>View the deployed dashboard: https://tm2-validation-dashboard.streamlit.app/</p>"},{"location":"dashboard/#running-locally","title":"Running Locally","text":""},{"location":"dashboard/#quick-start","title":"Quick Start","text":"<pre><code>cd tm2py_utils/summary/validation\nstreamlit run dashboard/dashboard_app.py --server.port 8501\n</code></pre> <p>The dashboard will open at <code>http://localhost:8501</code></p>"},{"location":"dashboard/#using-the-deployment-script","title":"Using the Deployment Script","text":"<pre><code># Generate summaries and launch dashboard\npython run_and_deploy_dashboard.py --config validation_config.yaml --launch-dashboard\n\n# Use custom port\npython run_and_deploy_dashboard.py --config validation_config.yaml --launch-dashboard --port 8503\n</code></pre>"},{"location":"dashboard/#dashboard-tabs","title":"Dashboard Tabs","text":""},{"location":"dashboard/#0-population","title":"0. Population","text":"<p>Synthetic population from PopulationSim with ACS validation: - Household size distribution - Income distribution - Geographic distribution by county - Workers per household - Age distribution</p>"},{"location":"dashboard/#1-households","title":"1. Households","text":"<p>Auto ownership analysis from CTRAMP model: - Regional auto ownership - By income category - By household size (with ACS comparison) - By county</p>"},{"location":"dashboard/#2-activity-patterns","title":"2. Activity Patterns","text":"<p>Coordinated daily activity patterns (CDAP): - Overall distribution - By person type (worker, student, etc.) - By age group - By home county - By auto ownership</p>"},{"location":"dashboard/#3-tours","title":"3. Tours","text":"<p>Tour frequency and characteristics: - Tours by purpose - Tours by mode - Tour distance distribution - Tour duration distribution</p>"},{"location":"dashboard/#4-trips","title":"4. Trips","text":"<p>Trip-level analysis: - Trips by mode - Trips by purpose - Mode by purpose cross-tabs - Trip distance and duration</p>"},{"location":"dashboard/#5-journey-to-work","title":"5. Journey to Work","text":"<p>Commute pattern analysis: - Commute distance by origin-destination - Commute time by origin-destination - Mode share for work tours - Mode by origin-destination</p>"},{"location":"dashboard/#6-time-of-day","title":"6. Time of Day","text":"<p>Temporal distribution of travel: - Tour departure times - Tour arrival times - Tour timing by purpose and mode - Trip mode by time period</p>"},{"location":"dashboard/#7-trip-characteristics","title":"7. Trip Characteristics","text":"<p>Detailed distance and time analysis: - Trip distance distribution - Average distance by income/mode/purpose - Trip duration distribution - Average time by income/mode/purpose</p>"},{"location":"dashboard/#dashboard-features","title":"Dashboard Features","text":""},{"location":"dashboard/#interactive-charts","title":"Interactive Charts","text":"<ul> <li>Hover: See exact values</li> <li>Zoom: Click and drag to zoom in</li> <li>Pan: Shift+drag to pan</li> <li>Reset: Double-click to reset view</li> <li>Download: Camera icon to save as PNG</li> </ul>"},{"location":"dashboard/#filters","title":"Filters","text":"<ul> <li>Dataset Comparison: Select which model runs to compare</li> <li>Faceting: Some charts split data across multiple panels</li> </ul>"},{"location":"dashboard/#data-export","title":"Data Export","text":"<p>Click the download icon on any chart to export as PNG for reports.</p>"},{"location":"dashboard/#customizing-the-dashboard","title":"Customizing the Dashboard","text":""},{"location":"dashboard/#adding-new-charts","title":"Adding New Charts","text":"<p>Edit or create dashboard YAML files in <code>dashboard/</code> folder:</p> <pre><code>dashboard:\n  tab: My New Tab\n  title: Custom Analysis\n  description: Description of what this shows\n\nsections:\n  my_section:\n    title: \"Section Title\"\n    charts:\n      - type: bar\n        title: \"Chart Title\"\n        dataset: my_data.csv\n        x: category\n        y: value\n        color: dataset\n        axis_labels:\n          category: \"Category Name\"\n          value: \"Value Label\"\n</code></pre>"},{"location":"dashboard/#chart-types","title":"Chart Types","text":"<p>Supported chart types: - <code>bar</code> - Bar charts (most common) - <code>line</code> - Line charts - <code>scatter</code> - Scatter plots</p>"},{"location":"dashboard/#faceting","title":"Faceting","text":"<p>Split charts across multiple panels:</p> <pre><code>- type: bar\n  title: \"My Chart\"\n  dataset: data.csv\n  x: category\n  y: value\n  color: subcategory\n  facet: dataset  # Creates separate panel for each dataset\n</code></pre>"},{"location":"dashboard/#data-requirements","title":"Data Requirements","text":"<p>The dashboard reads CSV files from <code>outputs/dashboard/</code> directory. Each CSV must have:</p> <ol> <li>Column for x-axis (categories, modes, etc.)</li> <li>Column for y-axis (counts, shares, averages, etc.)</li> <li>dataset column (to distinguish between model runs)</li> </ol> <p>Example CSV structure:</p> <pre><code>trip_mode,trips,share,dataset\nDrive Alone,1000000,45.2,2023 TM2.2 v05\nCarpool,300000,13.6,2023 TM2.2 v05\nTransit,200000,9.0,2023 TM2.2 v05\nDrive Alone,950000,43.8,2015 TM2.2 Sprint 04\n...\n</code></pre>"},{"location":"dashboard/#troubleshooting","title":"Troubleshooting","text":""},{"location":"dashboard/#no-data-available","title":"\"No data available\"","text":"<p>Ensure CSV files exist in <code>outputs/dashboard/</code> and column names match the YAML configuration.</p>"},{"location":"dashboard/#port-already-in-use","title":"Port already in use","text":"<p>Use a different port: <pre><code>streamlit run dashboard/dashboard_app.py --server.port 8503\n</code></pre></p>"},{"location":"dashboard/#charts-not-updating","title":"Charts not updating","text":"<p>Streamlit auto-reloads when files change. If not working, refresh the browser (F5).</p>"},{"location":"dashboard/#missing-tabs","title":"Missing tabs","text":"<p>Check that dashboard YAML files are in <code>dashboard/</code> directory (not <code>outputs/dashboard/</code>).</p>"},{"location":"dashboard/#deployment","title":"Deployment","text":"<p>The dashboard auto-deploys to Streamlit Cloud when changes are pushed to the main branch on GitHub.</p> <p>Live URL: https://tm2-validation-dashboard.streamlit.app/</p>"},{"location":"dashboard/#manual-deployment","title":"Manual Deployment","text":"<p>To deploy your own instance:</p> <ol> <li>Create a Streamlit Cloud account</li> <li>Connect your GitHub repository</li> <li>Set main file: <code>tm2py_utils/summary/validation/dashboard/dashboard_app.py</code></li> <li>Deploy!</li> </ol>"},{"location":"dashboard/#next-steps","title":"Next Steps","text":"<ul> <li>Generate Summaries to populate dashboard data</li> <li>Customize Configuration to add new analyses</li> </ul>"},{"location":"install/","title":"Installation Guide","text":""},{"location":"install/#prerequisites","title":"Prerequisites","text":"<ul> <li>Python: 3.9 or higher</li> <li>Conda: Anaconda or Miniconda</li> <li>Git: For cloning the repository</li> </ul>"},{"location":"install/#installation-steps","title":"Installation Steps","text":""},{"location":"install/#1-clone-the-repository","title":"1. Clone the Repository","text":"<pre><code>git clone https://github.com/BayAreaMetro/tm2py-utils.git\ncd tm2py-utils\n</code></pre>"},{"location":"install/#2-create-conda-environment","title":"2. Create Conda Environment","text":"<pre><code># Create environment from environment.yml (if available)\nconda env create -f environment.yml\n\n# Or create manually\nconda create -n tm2py-utils python=3.9 pandas numpy pyyaml\nconda activate tm2py-utils\n</code></pre>"},{"location":"install/#3-install-dependencies","title":"3. Install Dependencies","text":"<pre><code># Install required packages\npip install -r requirements.txt\n\n# Install additional dashboard dependencies\npip install streamlit plotly\n</code></pre>"},{"location":"install/#4-install-tm2py-utils","title":"4. Install tm2py-utils","text":"<pre><code># Install in development mode\npip install -e .\n</code></pre>"},{"location":"install/#verifying-installation","title":"Verifying Installation","text":"<p>Test that the installation works:</p> <pre><code># Check package is importable\npython -c \"import tm2py_utils; print('tm2py-utils installed successfully!')\"\n\n# List available summaries\ncd tm2py_utils/summary/validation\npython list_summaries.py\n</code></pre>"},{"location":"install/#optional-set-up-data-paths","title":"Optional: Set Up Data Paths","text":"<p>Edit <code>tm2py_utils/summary/validation/validation_config.yaml</code> to point to your model output directories:</p> <pre><code>input_directories:\n  - path: \"E:\\\\model_runs\\\\2023-tm22-dev-version-05\\\\ctramp_output\"\n    name: \"2023_version_05\"\n    display_name: \"2023 TM2.2 v05\"\n</code></pre>"},{"location":"install/#troubleshooting","title":"Troubleshooting","text":""},{"location":"install/#import-errors","title":"Import Errors","text":"<p>If you get <code>ModuleNotFoundError</code>, ensure you've activated the conda environment:</p> <pre><code>conda activate tm2py-utils\n</code></pre>"},{"location":"install/#streamlit-not-found","title":"Streamlit Not Found","text":"<p>If <code>streamlit</code> command is not recognized:</p> <pre><code>pip install streamlit\n</code></pre>"},{"location":"install/#permission-errors","title":"Permission Errors","text":"<p>On Windows, you may need to run PowerShell as Administrator for some operations.</p>"},{"location":"install/#next-steps","title":"Next Steps","text":"<ul> <li>Run the Dashboard</li> <li>Generate Summaries</li> <li>Configure Analysis</li> </ul>"},{"location":"summaries/","title":"Summary Generation System","text":"<p>The tm2py-utils summary system generates aggregated statistics from CTRAMP model outputs for validation and comparison.</p>"},{"location":"summaries/#overview","title":"Overview","text":"<p>The system provides: - 34 configured summaries (21 core + 13 validation) - Config-driven - Add summaries via YAML, no Python coding - Flexible filtering - Generate core, validation, or all summaries - Multiple output formats - CSV, Parquet</p>"},{"location":"summaries/#quick-start","title":"Quick Start","text":""},{"location":"summaries/#view-configured-summaries","title":"View Configured Summaries","text":"<pre><code>cd tm2py_utils/summary/validation\npython list_summaries.py\n</code></pre>"},{"location":"summaries/#generate-all-summaries","title":"Generate All Summaries","text":"<pre><code>python -m tm2py_utils.summary.validation.summaries.run_all \\\n  --config validation_config.yaml\n</code></pre>"},{"location":"summaries/#generate-core-summaries-only","title":"Generate Core Summaries Only","text":"<p>Edit <code>validation_config.yaml</code>: <pre><code>generate_summaries: \"core\"\n</code></pre></p> <p>Then run: <pre><code>python -m tm2py_utils.summary.validation.summaries.run_all \\\n  --config validation_config.yaml\n</code></pre></p>"},{"location":"summaries/#summary-types","title":"Summary Types","text":""},{"location":"summaries/#core-summaries-21","title":"Core Summaries (21)","text":"<p>Essential analysis matching legacy <code>core_summaries.py</code> outputs:</p> <p>Households: - Auto ownership (regional, by income)</p> <p>Activity Patterns (CDAP): - Overall distribution - By person type, age, county, auto ownership</p> <p>Tours: - Frequency by purpose - Mode choice (overall and by purpose) - Start/end times</p> <p>Trips: - Mode choice (overall and by purpose) - Purpose distribution - Mode by time period - Distance and travel time (detailed)</p> <p>Commute: - Journey to work (distance/time by OD) - Journey to work by mode</p>"},{"location":"summaries/#validation-summaries-13","title":"Validation Summaries (13)","text":"<p>Extended analysis for detailed validation and dashboard:</p> <p>Households: - Auto ownership by household size - Auto ownership by household size (ACS-comparable) - Auto ownership by county</p> <p>Tours: - Mode choice (aggregated categories) - Mode by purpose (aggregated) - Distance distribution (binned) - Duration distribution (binned)</p> <p>Trips: - Mode choice (aggregated categories) - Mode by purpose (aggregated) - Departure time distribution - Distance distribution (binned) - Duration distribution (binned)</p>"},{"location":"summaries/#configuration","title":"Configuration","text":""},{"location":"summaries/#setting-summary-filter","title":"Setting Summary Filter","text":"<p>Edit <code>validation_config.yaml</code>:</p> <pre><code># Options: \"all\", \"core\", \"validation\"\ngenerate_summaries: \"core\"\n</code></pre>"},{"location":"summaries/#adding-custom-summaries","title":"Adding Custom Summaries","text":"<p>Add to <code>custom_summaries</code> section in <code>validation_config.yaml</code>:</p> <pre><code>custom_summaries:\n  - name: \"my_new_summary\"\n    summary_type: \"validation\"  # or \"core\"\n    description: \"What this summarizes\"\n    data_source: \"individual_trips\"  # or households, tours, persons, etc.\n    group_by: [\"trip_mode\", \"tour_purpose\"]\n    weight_field: \"sample_rate\"\n    count_name: \"trips\"\n    share_within: \"tour_purpose\"  # Calculate shares within groups\n</code></pre>"},{"location":"summaries/#available-data-sources","title":"Available Data Sources","text":"<ul> <li><code>households</code> - Household-level data</li> <li><code>persons</code> - Person-level data</li> <li><code>individual_tours</code> - Tour-level data</li> <li><code>individual_trips</code> - Trip-level data</li> <li><code>workplace_school</code> - Work/school location choice</li> </ul>"},{"location":"summaries/#aggregation-options","title":"Aggregation Options","text":"<p>Simple count: <pre><code>group_by: \"trip_mode\"\ncount_name: \"trips\"\n</code></pre></p> <p>Multiple aggregations: <pre><code>group_by: [\"income_category_bin\", \"trip_mode\"]\naggregations:\n  trips: \"count\"\n  avg_distance: {\"column\": \"trip_distance_miles\", \"agg\": \"mean\"}\n  total_time: {\"column\": \"trip_time_minutes\", \"agg\": \"sum\"}\n</code></pre></p> <p>Share calculations: <pre><code>group_by: [\"tour_purpose\", \"tour_mode\"]\nshare_within: \"tour_purpose\"  # Each purpose sums to 100%\n</code></pre></p>"},{"location":"summaries/#binning-continuous-variables","title":"Binning Continuous Variables","text":"<pre><code>group_by: [\"income_category_bin\", \"trip_mode\"]\nbins:\n  income_category:\n    breaks: [0, 30000, 60000, 100000, 150000, 1000000000]\n    labels: ['&lt;30K', '30-60K', '60-100K', '100-150K', '150K+']\n</code></pre>"},{"location":"summaries/#output-files","title":"Output Files","text":"<p>Summaries are written to <code>outputs/</code> directory:</p> <pre><code>outputs/\n\u251c\u2500\u2500 auto_ownership_regional.csv\n\u251c\u2500\u2500 tour_mode_choice.csv\n\u251c\u2500\u2500 trip_distance.csv\n\u2514\u2500\u2500 ...\n</code></pre>"},{"location":"summaries/#csv-format","title":"CSV Format","text":"<p>Example output:</p> <pre><code>tour_mode,tours,share,dataset\nDrive Alone,450000,42.5,2023 TM2.2 v05\nCarpool,180000,17.0,2023 TM2.2 v05\nTransit,95000,9.0,2023 TM2.2 v05\n...\n</code></pre>"},{"location":"summaries/#deployment-workflow","title":"Deployment Workflow","text":""},{"location":"summaries/#using-the-deployment-script","title":"Using the Deployment Script","text":"<pre><code>cd tm2py_utils/summary/validation\n\n# Generate all summaries and copy to dashboard\npython run_and_deploy_dashboard.py --config validation_config.yaml\n\n# Generate only core summaries\npython run_and_deploy_dashboard.py --config validation_config.yaml --summaries core\n\n# Generate and launch dashboard\npython run_and_deploy_dashboard.py --config validation_config.yaml --launch-dashboard\n</code></pre>"},{"location":"summaries/#using-batch-script-windows","title":"Using Batch Script (Windows)","text":"<p>Double-click <code>deploy_dashboard.bat</code> for interactive menu:</p> <ol> <li>Generate ALL summaries</li> <li>Generate CORE summaries only</li> <li>Generate VALIDATION summaries only</li> <li>Copy existing summaries (skip generation)</li> <li>Generate and LAUNCH dashboard</li> </ol>"},{"location":"summaries/#manual-steps","title":"Manual Steps","text":"<pre><code># 1. Generate summaries\npython -m tm2py_utils.summary.validation.summaries.run_all \\\n  --config validation_config.yaml\n\n# 2. Copy to dashboard folder\ncp outputs/*.csv outputs/dashboard/\n\n# 3. Launch dashboard\nstreamlit run dashboard/dashboard_app.py --server.port 8501\n</code></pre>"},{"location":"summaries/#data-model","title":"Data Model","text":"<p>Column mappings are defined in <code>data_model/ctramp_data_model.yaml</code>:</p> <pre><code>individual_trips:\n  file_pattern: \"indivTripData_{iteration}.csv\"\n  columns:\n    trip_mode: \"trip_mode\"\n    tour_purpose: \"tour_purpose\"\n    trip_distance: \"trip_distance_miles\"\n    depart_period: \"depart_period\"\n</code></pre> <p>Variable labels in <code>variable_labels.yaml</code>:</p> <pre><code>trip_mode: \"Trip Mode\"\ntour_purpose: \"Tour Purpose\"\nincome_category_bin: \"Income Category\"\n</code></pre>"},{"location":"summaries/#performance","title":"Performance","text":"<p>Typical runtimes on a standard laptop:</p> <ul> <li>Core summaries only: ~5-10 minutes</li> <li>All summaries: ~15-20 minutes</li> <li>Memory usage: ~2-4 GB</li> </ul> <p>For large model runs, consider: - Generating core summaries only for quick checks - Running full validation suite overnight</p>"},{"location":"summaries/#troubleshooting","title":"Troubleshooting","text":""},{"location":"summaries/#no-summaries-generated","title":"No summaries generated","text":"<p>Check that input directories in <code>validation_config.yaml</code> exist and contain CTRAMP output files: - <code>indivTripData_1.csv</code> - <code>householdData_1.csv</code> - <code>indivTourData_1.csv</code> - etc.</p>"},{"location":"summaries/#column-not-found-errors","title":"Column not found errors","text":"<p>Check <code>ctramp_data_model.yaml</code> for correct column mappings.</p>"},{"location":"summaries/#memory-errors","title":"Memory errors","text":"<p>Reduce the number of input directories or process one at a time.</p>"},{"location":"summaries/#wrong-summaries-generated","title":"Wrong summaries generated","text":"<p>Run <code>python list_summaries.py</code> to see what will be generated based on current config.</p>"},{"location":"summaries/#next-steps","title":"Next Steps","text":"<ul> <li>Configure Dashboard to visualize summaries</li> <li>Customize Configuration for your analysis needs</li> <li>See Consolidation Proposal for system architecture</li> </ul>"}]}