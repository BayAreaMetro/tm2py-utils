{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"tm2py-utils","text":"<p>Utilities and analysis tools for Travel Model Two (TM2)</p>"},{"location":"#overview","title":"Overview","text":"<p><code>tm2py-utils</code> provides a collection of utilities for working with Travel Model Two outputs, including:</p> <ul> <li>Validation Dashboard - Interactive web dashboard for model validation and scenario comparison</li> <li>Summary Generation - Automated summary statistics from CTRAMP model outputs</li> <li>PopulationSim Integration - Synthetic population analysis and validation</li> <li>Network Analysis - Tools for analyzing transportation networks</li> </ul>"},{"location":"#quick-start","title":"Quick Start","text":""},{"location":"#installation","title":"Installation","text":"<pre><code># Clone repository\ngit clone https://github.com/BayAreaMetro/tm2py-utils.git\ncd tm2py-utils\n\n# Create conda environment\nconda env create -f environment.yml\nconda activate tm2py_utils\n\n# Install package\npip install -e .\n</code></pre> <p>See Installation Guide for detailed instructions.</p>"},{"location":"#running-the-validation-dashboard","title":"Running the Validation Dashboard","text":"<pre><code># Navigate to validation directory\ncd tm2py_utils/summary/validation\n\n# Launch dashboard\nstreamlit run dashboard/dashboard_app.py --server.port 8501\n</code></pre> <p>Or use the deployment script:</p> <pre><code># Generate summaries and launch dashboard\npython run_and_deploy_dashboard.py --config validation_config.yaml --launch-dashboard\n</code></pre> <p>View the live dashboard: https://tm2-validation-dashboard.streamlit.app/</p> <p>\ud83d\udcda New to the validation system? Check out the Complete Validation System Guide for step-by-step instructions on: - Creating summaries from model runs - Adding observed data (ACS, CTPP, surveys) - Custom aggregations and binning - Dashboard visualization - Deployment options</p>"},{"location":"#key-features","title":"Key Features","text":""},{"location":"#validation-dashboard","title":"\ud83d\udcca Validation Dashboard","text":"<p>Interactive web-based dashboard for comparing model runs and validating against observed data:</p> <ul> <li>Population - Synthetic population demographics (from PopulationSim)</li> <li>Households - Auto ownership patterns</li> <li>Activity Patterns - Daily activity patterns (CDAP)</li> <li>Tours - Tour frequency and mode choice</li> <li>Trips - Trip mode and purpose analysis</li> <li>Journey to Work - Commute patterns</li> <li>Time of Day - Temporal distribution of travel</li> <li>Trip Characteristics - Distance and travel time</li> </ul>"},{"location":"#summary-generation","title":"\ud83d\udd27 Summary Generation","text":"<p>Config-driven system for generating model validation summaries:</p> <ul> <li>Core Summaries (21) - Essential analysis matching legacy outputs</li> <li>Validation Summaries (13) - Extended analysis for dashboard</li> <li>Custom Summaries - Easy to add via YAML configuration</li> </ul> <pre><code># Generate all summaries\npython -m tm2py_utils.summary.validation.summaries.run_all --config validation_config.yaml\n\n# Generate only core summaries (fast)\n# Edit validation_config.yaml: generate_summaries: \"core\"\npython -m tm2py_utils.summary.validation.summaries.run_all --config validation_config.yaml\n</code></pre>"},{"location":"#populationsim-integration","title":"\ud83c\udfd8\ufe0f PopulationSim Integration","text":"<p>Analysis tools for synthetic population outputs:</p> <ul> <li>Household demographics (size, income, workers)</li> <li>Person demographics (age distribution)</li> <li>Geographic distribution by county</li> <li>Validation against ACS data</li> </ul>"},{"location":"#documentation","title":"Documentation","text":"<ul> <li>Installation Guide</li> <li>Dashboard Guide</li> <li>Summary System</li> <li>Contributing</li> <li>Consolidation Proposal - Plan to consolidate summary systems</li> </ul>"},{"location":"#architecture","title":"Architecture","text":"<pre><code>tm2py_utils/\n\u251c\u2500\u2500 summary/\n\u2502   \u251c\u2500\u2500 validation/              # Validation dashboard and summaries\n\u2502   \u2502   \u251c\u2500\u2500 dashboard/           # Dashboard YAML configs and app\n\u2502   \u2502   \u251c\u2500\u2500 summaries/           # Summary generation scripts\n\u2502   \u2502   \u251c\u2500\u2500 data_model/          # Data model definitions\n\u2502   \u2502   \u251c\u2500\u2500 outputs/             # Generated summary CSVs\n\u2502   \u2502   \u2514\u2500\u2500 validation_config.yaml\n\u2502   \u2514\u2500\u2500 core_summaries/          # Legacy summary system (being deprecated)\n\u251c\u2500\u2500 inputs/                      # Input data preparation tools\n\u251c\u2500\u2500 requests/                    # Special analysis requests\n\u2514\u2500\u2500 docs/                        # Documentation (this site)\n</code></pre>"},{"location":"#related-projects","title":"Related Projects","text":"<ul> <li>tm2py - Main Travel Model Two implementation</li> <li>PopulationSim - Synthetic population generator</li> <li>Bay Area UrbanSim - Land use model</li> </ul>"},{"location":"#support","title":"Support","text":"<ul> <li>Issues: GitHub Issues</li> <li>Discussions: GitHub Discussions</li> <li>MTC Contact: modeling@bayareametro.gov</li> </ul>"},{"location":"#license","title":"License","text":"<p>This project is licensed under the Apache License 2.0 - see the LICENSE file for details.</p>"},{"location":"configuration/","title":"Configuration Reference","text":"<p>Complete reference for <code>validation_config.yaml</code> and related configuration files.</p>"},{"location":"configuration/#validation_configyaml","title":"validation_config.yaml","text":"<p>Main configuration file for summary generation and dashboard deployment.</p>"},{"location":"configuration/#top-level-settings","title":"Top-Level Settings","text":"<pre><code># Summary generation filter: \"all\", \"core\", or \"validation\"\ngenerate_summaries: \"all\"\n\n# Base directories for input data\ninput_directories:\n  - path: \"/path/to/model/run/outputs\"\n    label: \"2023 TM2.2 v05\"\n  - path: \"/path/to/another/run\"\n    label: \"2015 TM2.2 Sprint 04\"\n\n# Output directory for generated summaries\noutput_directory: \"outputs\"\n\n# Observed data for validation\nobserved_data_sources:\n  - name: \"ACS 2019\"\n    directory: \"/path/to/observed/data\"\n    files:\n      auto_ownership: \"acs_auto_ownership.csv\"\n      household_size: \"acs_household_size.csv\"\n\n# Custom summary definitions\ncustom_summaries:\n  - name: \"my_summary\"\n    # ... (see Custom Summaries section)\n</code></pre>"},{"location":"configuration/#input-directories","title":"Input Directories","text":"<p>Each entry requires:</p> <pre><code>input_directories:\n  - path: \"/absolute/path/to/outputs\"  # Absolute path to CTRAMP outputs\n    label: \"Dataset Name\"               # Display name in charts\n</code></pre> <p>Expected files in directory: - <code>householdData_1.csv</code> - <code>personData_1.csv</code> - <code>indivTourData_1.csv</code> - <code>indivTripData_1.csv</code> - <code>wsLocResults.csv</code></p>"},{"location":"configuration/#custom-summaries","title":"Custom Summaries","text":""},{"location":"configuration/#required-fields","title":"Required Fields","text":"<pre><code>custom_summaries:\n  - name: \"summary_identifier\"          # Unique name (becomes filename)\n    summary_type: \"core\"                # \"core\" or \"validation\"\n    description: \"What this summarizes\" # Human-readable description\n    data_source: \"individual_trips\"     # Data source (see below)\n</code></pre>"},{"location":"configuration/#data-sources","title":"Data Sources","text":"<p>Available options:</p> <ul> <li><code>households</code> - Household-level data</li> <li><code>persons</code> - Person-level data</li> <li><code>individual_tours</code> - Tour-level data</li> <li><code>individual_trips</code> - Trip-level data</li> <li><code>workplace_school</code> - Work/school location choice</li> <li><code>synthetic_population</code> - PopulationSim output</li> </ul>"},{"location":"configuration/#basic-grouping","title":"Basic Grouping","text":"<p>Single column: <pre><code>group_by: \"trip_mode\"\ncount_name: \"trips\"  # Column name for counts\n</code></pre></p> <p>Multiple columns: <pre><code>group_by: [\"income_category_bin\", \"trip_mode\"]\ncount_name: \"trips\"\n</code></pre></p>"},{"location":"configuration/#aggregations","title":"Aggregations","text":"<p>Simple count: <pre><code>count_name: \"trips\"\n</code></pre></p> <p>Multiple aggregations: <pre><code>aggregations:\n  trips: \"count\"                                    # Count rows\n  avg_distance:                                     # Mean\n    column: \"trip_distance_miles\"\n    agg: \"mean\"\n  total_time:                                       # Sum\n    column: \"trip_time_minutes\"\n    agg: \"sum\"\n  max_distance:                                     # Max\n    column: \"trip_distance_miles\"\n    agg: \"max\"\n  min_distance:                                     # Min\n    column: \"trip_distance_miles\"\n    agg: \"min\"\n</code></pre></p> <p>Available aggregation functions: - <code>count</code> - Count rows - <code>mean</code> - Average - <code>sum</code> - Total - <code>max</code> - Maximum value - <code>min</code> - Minimum value - <code>median</code> - Median value - <code>std</code> - Standard deviation</p>"},{"location":"configuration/#share-calculations","title":"Share Calculations","text":"<p>Calculate percentages within groups:</p> <pre><code>group_by: [\"tour_purpose\", \"tour_mode\"]\nshare_within: \"tour_purpose\"  # Each purpose sums to 100%\n</code></pre> <p>Without <code>share_within</code>, shares calculated across all rows.</p>"},{"location":"configuration/#weighting","title":"Weighting","text":"<p>Apply sample expansion factors:</p> <pre><code>weight_field: \"sample_rate\"  # Column containing weights\n</code></pre>"},{"location":"configuration/#binning","title":"Binning","text":"<p>Discretize continuous variables:</p> <pre><code>group_by: [\"income_bin\", \"auto_ownership\"]\nbins:\n  income:\n    breaks: [0, 30000, 60000, 100000, 150000, 1000000000]\n    labels: ['&lt;30K', '30-60K', '60-100K', '100-150K', '150K+']\n\n  distance:\n    breaks: [0, 5, 10, 20, 50, 1000]\n    labels: ['&lt;5mi', '5-10mi', '10-20mi', '20-50mi', '50+mi']\n</code></pre> <p>Note: Column name in <code>group_by</code> must match bin name (e.g., <code>income_bin</code> references <code>income</code> bin definition).</p>"},{"location":"configuration/#filtering","title":"Filtering","text":"<p>Apply filters before aggregation:</p> <pre><code>filters:\n  tour_purpose: [\"Work\", \"School\"]    # Include only these values\n  trip_distance_miles: {\"&gt;\": 0}       # Distance greater than 0\n</code></pre> <p>Available operators: - <code>[\"value1\", \"value2\"]</code> - Equals any of these - <code>{\"&gt;\": value}</code> - Greater than - <code>{\"&lt;\": value}</code> - Less than - <code>{\"&gt;=\": value}</code> - Greater than or equal - <code>{\"&lt;=\": value}</code> - Less than or equal</p>"},{"location":"configuration/#observed-data","title":"Observed Data","text":"<p>Compare to validation data:</p> <pre><code>observed_data: \"ACS 2019\"      # Name from observed_data_sources\nobserved_file: \"auto_ownership\" # File key from observed_data_sources\n</code></pre> <p>Observed data merged into output with <code>dataset</code> = observed data name.</p>"},{"location":"configuration/#complete-summary-example","title":"Complete Summary Example","text":"<pre><code>custom_summaries:\n  - name: \"trip_distance_by_mode_income\"\n    summary_type: \"validation\"\n    description: \"Trip distance distribution by mode and income category\"\n    data_source: \"individual_trips\"\n    group_by: [\"distance_bin\", \"trip_mode\", \"income_bin\"]\n    weight_field: \"sample_rate\"\n    aggregations:\n      trips: \"count\"\n      avg_distance:\n        column: \"trip_distance_miles\"\n        agg: \"mean\"\n    bins:\n      distance:\n        breaks: [0, 5, 10, 20, 50, 1000]\n        labels: ['&lt;5mi', '5-10mi', '10-20mi', '20-50mi', '50+mi']\n      income:\n        breaks: [0, 30000, 60000, 100000, 150000, 1000000000]\n        labels: ['&lt;30K', '30-60K', '60-100K', '100-150K', '150K+']\n    filters:\n      trip_distance_miles: {\"&gt;\": 0}\n    share_within: \"income_bin\"\n</code></pre>"},{"location":"configuration/#ctramp_data_modelyaml","title":"ctramp_data_model.yaml","text":"<p>Maps CTRAMP output file columns to standardized names.</p>"},{"location":"configuration/#structure","title":"Structure","text":"<pre><code>data_source_name:\n  file_pattern: \"fileName_{iteration}.csv\"  # {iteration} replaced with run iteration\n  columns:\n    standard_name: \"ctramp_column_name\"\n</code></pre>"},{"location":"configuration/#example","title":"Example","text":"<pre><code>individual_trips:\n  file_pattern: \"indivTripData_{iteration}.csv\"\n  columns:\n    trip_mode: \"trip_mode\"\n    tour_purpose: \"tour_purpose\"\n    trip_distance_miles: \"trip_distance\"\n    depart_period: \"depart_period\"\n    trip_time_minutes: \"travelTime\"\n    sample_rate: \"sampleRate\"\n\nhouseholds:\n  file_pattern: \"householdData_{iteration}.csv\"\n  columns:\n    household_id: \"hh_id\"\n    income: \"income\"\n    auto_ownership: \"autos\"\n    household_size: \"size\"\n    county: \"county\"\n</code></pre>"},{"location":"configuration/#adding-new-mappings","title":"Adding New Mappings","text":"<ol> <li>Identify CTRAMP output file and column names</li> <li>Add to appropriate data source or create new section</li> <li>Use in <code>validation_config.yaml</code> summaries</li> </ol>"},{"location":"configuration/#variable_labelsyaml","title":"variable_labels.yaml","text":"<p>Human-readable labels for variables used in charts.</p>"},{"location":"configuration/#structure_1","title":"Structure","text":"<pre><code>column_name: \"Display Label\"\n</code></pre>"},{"location":"configuration/#example_1","title":"Example","text":"<pre><code># Mode\ntrip_mode: \"Trip Mode\"\ntour_mode: \"Tour Mode\"\n\n# Purpose\ntour_purpose: \"Tour Purpose\"\ntrip_purpose: \"Trip Purpose\"\n\n# Geography\ncounty: \"County\"\ntaz: \"TAZ\"\n\n# Household\nincome_category_bin: \"Income Category\"\nauto_ownership: \"Autos Owned\"\nhousehold_size: \"Household Size\"\n\n# Time\ndepart_period: \"Departure Period\"\narrive_period: \"Arrival Period\"\n\n# Distance/Time\ntrip_distance_miles: \"Distance (miles)\"\ntrip_time_minutes: \"Travel Time (minutes)\"\n</code></pre> <p>Labels automatically applied in dashboard charts.</p>"},{"location":"configuration/#dashboard-yaml-files","title":"Dashboard YAML Files","text":"<p>Located in <code>dashboard/</code> directory. Named <code>dashboard-N-title.yaml</code>.</p>"},{"location":"configuration/#structure_2","title":"Structure","text":"<pre><code>title: \"Tab Title\"\ndescription: \"Tab description shown at top\"\n\nsections:\n  - title: \"Section Name\"\n    layout: \"two_column\"  # single_column, two_column, three_column\n    charts:\n      - type: \"bar\"\n        title: \"Chart Title\"\n        # ... chart config\n\n      - type: \"line\"\n        title: \"Another Chart\"\n        # ... chart config\n</code></pre>"},{"location":"configuration/#chart-types","title":"Chart Types","text":""},{"location":"configuration/#bar-chart","title":"Bar Chart","text":"<pre><code>- type: \"bar\"\n  title: \"Trips by Mode\"\n  data_file: \"trip_mode_choice.csv\"\n  x: \"trip_mode\"\n  y: \"trips\"\n  color: \"dataset\"\n  orientation: \"h\"  # \"h\" or \"v\"\n  barmode: \"group\"  # \"group\", \"stack\", \"relative\"\n</code></pre>"},{"location":"configuration/#line-chart","title":"Line Chart","text":"<pre><code>- type: \"line\"\n  title: \"Mode Share Trend\"\n  data_file: \"mode_share_trend.csv\"\n  x: \"year\"\n  y: \"share\"\n  color: \"trip_mode\"\n</code></pre>"},{"location":"configuration/#scatter-plot","title":"Scatter Plot","text":"<pre><code>- type: \"scatter\"\n  title: \"Distance vs Time\"\n  data_file: \"trip_characteristics.csv\"\n  x: \"trip_distance_miles\"\n  y: \"trip_time_minutes\"\n  color: \"trip_mode\"\n</code></pre>"},{"location":"configuration/#box-plot","title":"Box Plot","text":"<pre><code>- type: \"box\"\n  title: \"Distance Distribution\"\n  data_file: \"trip_distance.csv\"\n  x: \"trip_mode\"\n  y: \"trip_distance_miles\"\n  color: \"dataset\"\n</code></pre>"},{"location":"configuration/#histogram","title":"Histogram","text":"<pre><code>- type: \"histogram\"\n  title: \"Trip Distance Distribution\"\n  data_file: \"trip_distance.csv\"\n  x: \"trip_distance_miles\"\n  nbins: 50\n</code></pre>"},{"location":"configuration/#chart-options","title":"Chart Options","text":""},{"location":"configuration/#faceting","title":"Faceting","text":"<p>Create subplots by category:</p> <pre><code>facet_col: \"county\"        # Create subplot for each county\nfacet_col_wrap: 2          # Number of columns\n</code></pre>"},{"location":"configuration/#category-ordering","title":"Category Ordering","text":"<p>Control order of categories:</p> <pre><code>category_orders:\n  trip_mode: [\"Walk\", \"Bike\", \"Transit\", \"Drive Alone\", \"Carpool\"]\n  income_category_bin: ['&lt;30K', '30-60K', '60-100K', '100-150K', '150K+']\n</code></pre>"},{"location":"configuration/#custom-labels","title":"Custom Labels","text":"<p>Override axis labels:</p> <pre><code>labels:\n  trip_mode: \"Travel Mode\"\n  trips: \"Number of Trips\"\n  share: \"Share (%)\"\n</code></pre>"},{"location":"configuration/#complete-chart-example","title":"Complete Chart Example","text":"<pre><code>- type: \"bar\"\n  title: \"Mode Choice by Income Category\"\n  data_file: \"trip_mode_by_income.csv\"\n  x: \"trip_mode\"\n  y: \"share\"\n  color: \"dataset\"\n  orientation: \"h\"\n  barmode: \"group\"\n  facet_col: \"income_category_bin\"\n  facet_col_wrap: 3\n  category_orders:\n    trip_mode: [\"Walk\", \"Bike\", \"Transit\", \"Drive Alone\", \"Carpool\"]\n    income_category_bin: ['&lt;30K', '30-60K', '60-100K', '100-150K', '150K+']\n  labels:\n    trip_mode: \"Travel Mode\"\n    share: \"Mode Share (%)\"\n</code></pre>"},{"location":"configuration/#environment-variables","title":"Environment Variables","text":"<p>Optional environment variables:</p> <pre><code># Dashboard port\nexport STREAMLIT_SERVER_PORT=8501\n\n# Data directory override\nexport TM2PY_UTILS_DATA_DIR=\"/path/to/data\"\n\n# Log level\nexport TM2PY_UTILS_LOG_LEVEL=\"DEBUG\"  # DEBUG, INFO, WARNING, ERROR\n</code></pre>"},{"location":"configuration/#file-locations","title":"File Locations","text":"<pre><code>tm2py_utils/summary/validation/\n\u251c\u2500\u2500 validation_config.yaml          # Main config\n\u251c\u2500\u2500 data_model/\n\u2502   \u251c\u2500\u2500 ctramp_data_model.yaml     # Column mappings\n\u2502   \u2514\u2500\u2500 variable_labels.yaml       # Display labels\n\u251c\u2500\u2500 dashboard/\n\u2502   \u251c\u2500\u2500 dashboard-0-population.yaml\n\u2502   \u251c\u2500\u2500 dashboard-1-households.yaml\n\u2502   \u2514\u2500\u2500 ...                         # Dashboard tab configs\n\u251c\u2500\u2500 outputs/                        # Generated summaries\n\u2502   \u251c\u2500\u2500 auto_ownership_regional.csv\n\u2502   \u251c\u2500\u2500 trip_mode_choice.csv\n\u2502   \u2514\u2500\u2500 dashboard/                  # Copied for dashboard\n\u2502       \u251c\u2500\u2500 auto_ownership_regional.csv\n\u2502       \u2514\u2500\u2500 ...\n\u2514\u2500\u2500 summaries/\n    \u251c\u2500\u2500 run_all.py                  # Main runner\n    \u2514\u2500\u2500 custom.py                   # Custom summary logic\n</code></pre>"},{"location":"configuration/#validation","title":"Validation","text":"<p>Check configuration validity before running:</p> <pre><code>cd tm2py_utils/summary/validation\n\n# Quick pre-flight check (recommended before every run)\npython check_config.py\n</code></pre> <p>Example output:</p> <pre><code>================================================================================\nTM2PY VALIDATION SYSTEM - QUICK CHECK\n================================================================================\n\n\ud83d\udcc4 Loading configuration...\n  \u2713 Configuration file is valid YAML\n\n\ud83d\udcc1 Checking input directories...\n  \u2713 2023 TM2.2 v05: A:\\2023-tm22-dev-version-05\\ctramp_output\n  \u2713 2015 TM2.2 Sprint 04: A:\\2015-tm22-dev-sprint-04\\ctramp_output\n\n\ud83d\udcca Counting configured summaries...\n  \u2713 29 active summaries configured\n\n\ud83d\udce6 Found 110 output CSV files in outputs/dashboard/\n\n\ud83c\udfa8 Checking dashboard configurations...\n  \u2713 8 dashboard files found\n\n================================================================================\n\u2705 BASIC CHECKS PASSED\n\nNext steps:\n  1. Generate summaries: python run_and_deploy_dashboard.py --config validation_config.yaml\n  2. Launch dashboard: streamlit run dashboard/dashboard_app.py\n</code></pre> <p>Additional validation commands:</p> <pre><code># Generate single summary for testing\npython -m tm2py_utils.summary.validation.summaries.run_all \\\n  --config validation_config.yaml --summary-name trip_mode_choice\n\n# Detailed validation (checks column availability - advanced)\npython validate_config.py\n</code></pre>"},{"location":"configuration/#common-configurations","title":"Common Configurations","text":""},{"location":"configuration/#core-vs-validation-filter","title":"Core vs Validation Filter","text":"<pre><code># Generate only core summaries (fast)\ngenerate_summaries: \"core\"\n\n# Generate only validation summaries\ngenerate_summaries: \"validation\"\n\n# Generate all summaries\ngenerate_summaries: \"all\"\n</code></pre>"},{"location":"configuration/#multiple-model-runs","title":"Multiple Model Runs","text":"<pre><code>input_directories:\n  - path: \"/model/runs/2015_base\"\n    label: \"2015 Base Year\"\n\n  - path: \"/model/runs/2023_v05\"\n    label: \"2023 TM2.2 v05\"\n\n  - path: \"/model/runs/2023_v06_draft\"\n    label: \"2023 TM2.2 v06 (draft)\"\n</code></pre> <p>All runs compared side-by-side in dashboard.</p>"},{"location":"configuration/#custom-output-location","title":"Custom Output Location","text":"<pre><code>output_directory: \"/shared/validation/outputs\"\n</code></pre>"},{"location":"configuration/#see-also","title":"See Also","text":"<ul> <li>Summary System Guide</li> <li>Dashboard Guide</li> <li>Contributing Guide</li> </ul>"},{"location":"contributing/","title":"Contributing to tm2py-utils","text":"<p>Thank you for contributing to tm2py-utils! This guide helps you add summaries, dashboard visualizations, and other features.</p>"},{"location":"contributing/#development-setup","title":"Development Setup","text":""},{"location":"contributing/#prerequisites","title":"Prerequisites","text":"<ul> <li>Python 3.9+</li> <li>Conda or virtualenv</li> <li>Git</li> </ul>"},{"location":"contributing/#installation","title":"Installation","text":"<pre><code># Clone repository\ngit clone https://github.com/BayAreaMetro/tm2py-utils.git\ncd tm2py-utils\n\n# Create environment\nconda env create -f environment.yml\nconda activate tm2py_utils\n\n# Install in development mode\npip install -e .\n\n# Install development dependencies\npip install pytest black flake8 mypy\n</code></pre>"},{"location":"contributing/#project-structure","title":"Project Structure","text":"<pre><code>tm2py_utils/\n\u251c\u2500\u2500 summary/\n\u2502   \u251c\u2500\u2500 validation/\n\u2502   \u2502   \u251c\u2500\u2500 summaries/           # Summary generation\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 run_all.py       # Main runner\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 custom.py        # Custom summary logic\n\u2502   \u2502   \u251c\u2500\u2500 dashboard/           # Dashboard YAML configs\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 dashboard-0-population.yaml\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 dashboard-1-households.yaml\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 ...\n\u2502   \u2502   \u251c\u2500\u2500 data_model/          # Column mappings\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 ctramp_data_model.yaml\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 variable_labels.yaml\n\u2502   \u2502   \u251c\u2500\u2500 validation_config.yaml\n\u2502   \u2502   \u2514\u2500\u2500 run_and_deploy_dashboard.py\n\u2502   \u2514\u2500\u2500 core_summaries/          # DEPRECATED - Use validation/ instead\n\u251c\u2500\u2500 inputs/                      # Input data processing\n\u251c\u2500\u2500 misc/                        # Utilities\n\u2514\u2500\u2500 docs/                        # Documentation\n</code></pre>"},{"location":"contributing/#adding-a-new-summary","title":"Adding a New Summary","text":""},{"location":"contributing/#1-define-in-configuration","title":"1. Define in Configuration","text":"<p>Edit <code>validation_config.yaml</code>:</p> <pre><code>custom_summaries:\n  - name: \"trip_length_by_mode_purpose\"\n    summary_type: \"validation\"  # or \"core\"\n    description: \"Trip distance by mode and purpose\"\n    data_source: \"individual_trips\"\n    group_by: [\"trip_mode\", \"tour_purpose\"]\n    weight_field: \"sample_rate\"\n    aggregations:\n      trips: \"count\"\n      avg_distance:\n        column: \"trip_distance_miles\"\n        agg: \"mean\"\n    share_within: \"tour_purpose\"\n</code></pre>"},{"location":"contributing/#2-test-generation","title":"2. Test Generation","text":"<pre><code>cd tm2py_utils/summary/validation\n\n# Check summary appears in list\npython list_summaries.py | grep trip_length_by_mode_purpose\n\n# Generate just your summary\npython -m tm2py_utils.summary.validation.summaries.run_all \\\n  --config validation_config.yaml\n</code></pre>"},{"location":"contributing/#3-verify-output","title":"3. Verify Output","text":"<p>Check output file: <pre><code>cat outputs/trip_length_by_mode_purpose.csv\n</code></pre></p> <p>Expected format: <pre><code>trip_mode,tour_purpose,trips,avg_distance,share,dataset\nDrive Alone,Work,150000,12.5,45.2,2023 TM2.2 v05\n...\n</code></pre></p>"},{"location":"contributing/#4-update-documentation","title":"4. Update Documentation","text":"<p>Add to appropriate section in <code>docs/summaries.md</code>.</p>"},{"location":"contributing/#adding-a-dashboard-tab","title":"Adding a Dashboard Tab","text":""},{"location":"contributing/#1-create-yaml-configuration","title":"1. Create YAML Configuration","text":"<p>Create <code>dashboard/dashboard-N-mytab.yaml</code>:</p> <pre><code>title: \"My New Analysis\"\ndescription: \"Description of what this tab shows\"\n\nsections:\n  - title: \"Overview\"\n    layout: \"two_column\"\n    charts:\n      - type: \"bar\"\n        title: \"My Metric by Category\"\n        data_file: \"my_summary.csv\"\n        x: \"category\"\n        y: \"value\"\n        color: \"dataset\"\n        orientation: \"h\"\n        facet_col: null\n\n      - type: \"line\"\n        title: \"Trend Over Time\"\n        data_file: \"my_trend.csv\"\n        x: \"year\"\n        y: \"value\"\n        color: \"category\"\n</code></pre>"},{"location":"contributing/#2-generate-required-data","title":"2. Generate Required Data","text":"<p>Ensure summaries in YAML exist in <code>validation_config.yaml</code>:</p> <pre><code>custom_summaries:\n  - name: \"my_summary\"\n    # ... configuration\n\n  - name: \"my_trend\"\n    # ... configuration\n</code></pre>"},{"location":"contributing/#3-test-dashboard","title":"3. Test Dashboard","text":"<pre><code>cd tm2py_utils/summary/validation\n\n# Generate summaries\npython run_and_deploy_dashboard.py --config validation_config.yaml\n\n# Launch dashboard\nstreamlit run dashboard/dashboard_app.py --server.port 8501\n</code></pre> <p>Visit http://localhost:8501 and check new tab appears.</p>"},{"location":"contributing/#4-dashboard-yaml-reference","title":"4. Dashboard YAML Reference","text":"<p>Chart Types: - <code>bar</code> - Bar chart (vertical or horizontal) - <code>line</code> - Line chart - <code>scatter</code> - Scatter plot - <code>box</code> - Box plot - <code>histogram</code> - Histogram</p> <p>Layout Options: - <code>single_column</code> - One chart per row - <code>two_column</code> - Two charts per row - <code>three_column</code> - Three charts per row</p> <p>Chart Properties: <pre><code>- type: \"bar\"\n  title: \"Chart Title\"\n  data_file: \"summary.csv\"        # CSV filename (must exist in outputs/dashboard/)\n  x: \"category_column\"            # X-axis column\n  y: \"value_column\"               # Y-axis column\n  color: \"dataset\"                # Color by column\n  orientation: \"h\"                # \"h\" or \"v\"\n  facet_col: \"another_category\"   # Create subplots by column\n  facet_col_wrap: 3               # Number of facet columns\n  barmode: \"group\"                # \"group\", \"stack\", or \"relative\"\n  category_orders:                # Custom ordering\n    category_column: [\"A\", \"B\", \"C\"]\n  labels:                         # Custom axis labels\n    category_column: \"Category\"\n    value_column: \"Count\"\n</code></pre></p>"},{"location":"contributing/#adding-a-column-mapping","title":"Adding a Column Mapping","text":"<p>If using new CTRAMP output columns:</p>"},{"location":"contributing/#1-update-data-model","title":"1. Update Data Model","text":"<p>Edit <code>data_model/ctramp_data_model.yaml</code>:</p> <pre><code>individual_trips:\n  file_pattern: \"indivTripData_{iteration}.csv\"\n  columns:\n    trip_mode: \"trip_mode\"\n    my_new_column: \"my_new_column\"  # Add mapping\n</code></pre>"},{"location":"contributing/#2-add-variable-label","title":"2. Add Variable Label","text":"<p>Edit <code>variable_labels.yaml</code>:</p> <pre><code>my_new_column: \"My New Column Label\"\n</code></pre>"},{"location":"contributing/#3-use-in-summary","title":"3. Use in Summary","text":"<pre><code>custom_summaries:\n  - name: \"summary_with_new_column\"\n    group_by: [\"my_new_column\"]\n    # ...\n</code></pre>"},{"location":"contributing/#code-style","title":"Code Style","text":""},{"location":"contributing/#python","title":"Python","text":"<p>Follow PEP 8:</p> <pre><code># Format code\nblack tm2py_utils/\n\n# Check style\nflake8 tm2py_utils/\n\n# Type checking\nmypy tm2py_utils/\n</code></pre>"},{"location":"contributing/#yaml","title":"YAML","text":"<ul> <li>Use 2-space indentation</li> <li>Quote strings with special characters</li> <li>Comment complex sections</li> </ul> <pre><code># Good\ncustom_summaries:\n  - name: \"my_summary\"\n    description: \"Clear description\"\n    group_by: [\"column1\", \"column2\"]\n\n# Avoid\ncustom_summaries:\n    - name: my_summary  # Missing quotes, 4-space indent\n      group_by: [column1]\n</code></pre>"},{"location":"contributing/#testing","title":"Testing","text":""},{"location":"contributing/#run-existing-tests","title":"Run Existing Tests","text":"<pre><code># All tests\npytest\n\n# Specific test\npytest tm2py_utils/summary/validation/test_summaries.py\n\n# With coverage\npytest --cov=tm2py_utils\n</code></pre>"},{"location":"contributing/#write-new-tests","title":"Write New Tests","text":"<p>Create <code>test_my_feature.py</code>:</p> <pre><code>import pytest\nfrom tm2py_utils.summary.validation import run_all\n\ndef test_my_summary_generation():\n    \"\"\"Test that my_summary generates expected output.\"\"\"\n    # Setup\n    config_path = \"test_config.yaml\"\n\n    # Run\n    run_all.main(config_path)\n\n    # Assert\n    output_file = \"outputs/my_summary.csv\"\n    assert output_file.exists()\n    # ... more assertions\n</code></pre>"},{"location":"contributing/#documentation","title":"Documentation","text":""},{"location":"contributing/#update-docs","title":"Update Docs","text":"<p>When adding features, update relevant documentation:</p> <ul> <li><code>docs/summaries.md</code> - For new summaries or configuration options</li> <li><code>docs/dashboard.md</code> - For new dashboard tabs or features</li> <li><code>docs/configuration.md</code> - For new config parameters</li> <li><code>README.md</code> - For major features</li> </ul>"},{"location":"contributing/#build-docs-locally","title":"Build Docs Locally","text":"<pre><code># Install mkdocs\npip install mkdocs mkdocs-material\n\n# Serve locally\ncd tm2py_utils\nmkdocs serve\n\n# Visit http://localhost:8000\n</code></pre>"},{"location":"contributing/#submitting-changes","title":"Submitting Changes","text":""},{"location":"contributing/#1-create-branch","title":"1. Create Branch","text":"<pre><code>git checkout -b feature/my-new-feature\n</code></pre>"},{"location":"contributing/#2-make-changes","title":"2. Make Changes","text":"<ul> <li>Add summaries to <code>validation_config.yaml</code></li> <li>Create dashboard YAML files</li> <li>Update documentation</li> </ul>"},{"location":"contributing/#3-test-changes","title":"3. Test Changes","text":"<pre><code># Run tests\npytest\n\n# Generate summaries\npython run_and_deploy_dashboard.py --config validation_config.yaml\n\n# Test dashboard\nstreamlit run dashboard/dashboard_app.py\n</code></pre>"},{"location":"contributing/#4-commit","title":"4. Commit","text":"<pre><code>git add .\ngit commit -m \"Add trip length analysis dashboard\n\n- Add trip_length_by_mode_purpose summary\n- Create dashboard-8-trip-length.yaml\n- Update summaries.md documentation\"\n</code></pre>"},{"location":"contributing/#5-push-and-create-pr","title":"5. Push and Create PR","text":"<pre><code>git push origin feature/my-new-feature\n</code></pre> <p>Then create Pull Request on GitHub.</p>"},{"location":"contributing/#common-patterns","title":"Common Patterns","text":""},{"location":"contributing/#binning-continuous-variables","title":"Binning Continuous Variables","text":"<pre><code>custom_summaries:\n  - name: \"trips_by_distance_bin\"\n    group_by: [\"distance_bin\", \"trip_mode\"]\n    bins:\n      distance:\n        breaks: [0, 5, 10, 20, 50, 1000]\n        labels: ['&lt;5mi', '5-10mi', '10-20mi', '20-50mi', '50+mi']\n</code></pre>"},{"location":"contributing/#multiple-aggregations","title":"Multiple Aggregations","text":"<pre><code>custom_summaries:\n  - name: \"trip_stats_by_mode\"\n    group_by: [\"trip_mode\"]\n    aggregations:\n      trips: \"count\"\n      avg_distance: {\"column\": \"trip_distance_miles\", \"agg\": \"mean\"}\n      total_time: {\"column\": \"trip_time_minutes\", \"agg\": \"sum\"}\n      max_distance: {\"column\": \"trip_distance_miles\", \"agg\": \"max\"}\n</code></pre>"},{"location":"contributing/#conditional-filters","title":"Conditional Filters","text":"<pre><code>custom_summaries:\n  - name: \"work_tours_only\"\n    data_source: \"individual_tours\"\n    filters:\n      tour_purpose: [\"Work\"]\n    group_by: [\"tour_mode\"]\n</code></pre>"},{"location":"contributing/#comparison-to-observed-data","title":"Comparison to Observed Data","text":"<p>Add to <code>observed_data_sources</code> in config:</p> <pre><code>observed_data_sources:\n  - name: \"ACS 2019\"\n    directory: \"/path/to/acs/data\"\n    files:\n      auto_ownership: \"acs_auto_ownership.csv\"\n</code></pre> <p>Then reference in summary:</p> <pre><code>custom_summaries:\n  - name: \"auto_ownership_regional\"\n    observed_data: \"ACS 2019\"\n    observed_file: \"auto_ownership\"\n</code></pre>"},{"location":"contributing/#getting-help","title":"Getting Help","text":"<ul> <li>Documentation: Check docs/</li> <li>Examples: See <code>examples/</code> directory</li> <li>Issues: Open on GitHub</li> <li>Email: modeling@bayareametro.gov</li> </ul>"},{"location":"contributing/#related-resources","title":"Related Resources","text":"<ul> <li>Consolidation Proposal - System architecture</li> <li>Dashboard Deployment Guide - Deployment workflow</li> <li>validation_config.yaml - Live configuration example</li> </ul>"},{"location":"dashboard/","title":"Dashboard Guide","text":"<p>The tm2py-utils validation dashboard is an interactive web application for comparing model runs and validating outputs against observed data.</p>"},{"location":"dashboard/#live-dashboard","title":"Live Dashboard","text":"<p>View the deployed dashboard: https://tm2-validation-dashboard.streamlit.app/</p>"},{"location":"dashboard/#running-locally","title":"Running Locally","text":""},{"location":"dashboard/#quick-start","title":"Quick Start","text":"<pre><code>cd tm2py_utils/summary/validation\nstreamlit run dashboard/dashboard_app.py --server.port 8501\n</code></pre> <p>The dashboard will open at <code>http://localhost:8501</code></p>"},{"location":"dashboard/#using-the-deployment-script","title":"Using the Deployment Script","text":"<pre><code># Generate summaries and launch dashboard\npython run_and_deploy_dashboard.py --config validation_config.yaml --launch-dashboard\n\n# Use custom port\npython run_and_deploy_dashboard.py --config validation_config.yaml --launch-dashboard --port 8503\n</code></pre>"},{"location":"dashboard/#dashboard-tabs","title":"Dashboard Tabs","text":""},{"location":"dashboard/#0-population","title":"0. Population","text":"<p>Synthetic population from PopulationSim with ACS validation: - Household size distribution - Income distribution - Geographic distribution by county - Workers per household - Age distribution</p>"},{"location":"dashboard/#1-households","title":"1. Households","text":"<p>Auto ownership analysis from CTRAMP model: - Regional auto ownership - By income category - By household size (with ACS comparison) - By county</p>"},{"location":"dashboard/#2-activity-patterns","title":"2. Activity Patterns","text":"<p>Coordinated daily activity patterns (CDAP): - Overall distribution - By person type (worker, student, etc.) - By age group - By home county - By auto ownership</p>"},{"location":"dashboard/#3-tours","title":"3. Tours","text":"<p>Tour frequency and characteristics: - Tours by purpose - Tours by mode - Tour distance distribution - Tour duration distribution</p>"},{"location":"dashboard/#4-trips","title":"4. Trips","text":"<p>Trip-level analysis: - Trips by mode - Trips by purpose - Mode by purpose cross-tabs - Trip distance and duration</p>"},{"location":"dashboard/#5-journey-to-work","title":"5. Journey to Work","text":"<p>Commute pattern analysis: - Commute distance by origin-destination - Commute time by origin-destination - Mode share for work tours - Mode by origin-destination</p>"},{"location":"dashboard/#6-time-of-day","title":"6. Time of Day","text":"<p>Temporal distribution of travel: - Tour departure times - Tour arrival times - Tour timing by purpose and mode - Trip mode by time period</p>"},{"location":"dashboard/#7-trip-characteristics","title":"7. Trip Characteristics","text":"<p>Detailed distance and time analysis: - Trip distance distribution - Average distance by income/mode/purpose - Trip duration distribution - Average time by income/mode/purpose</p>"},{"location":"dashboard/#dashboard-features","title":"Dashboard Features","text":""},{"location":"dashboard/#interactive-charts","title":"Interactive Charts","text":"<ul> <li>Hover: See exact values</li> <li>Zoom: Click and drag to zoom in</li> <li>Pan: Shift+drag to pan</li> <li>Reset: Double-click to reset view</li> <li>Download: Camera icon to save as PNG</li> </ul>"},{"location":"dashboard/#filters","title":"Filters","text":"<ul> <li>Dataset Comparison: Select which model runs to compare</li> <li>Faceting: Some charts split data across multiple panels</li> </ul>"},{"location":"dashboard/#data-export","title":"Data Export","text":"<p>Click the download icon on any chart to export as PNG for reports.</p>"},{"location":"dashboard/#customizing-the-dashboard","title":"Customizing the Dashboard","text":""},{"location":"dashboard/#adding-new-charts","title":"Adding New Charts","text":"<p>Edit or create dashboard YAML files in <code>dashboard/</code> folder:</p> <pre><code>dashboard:\n  tab: My New Tab\n  title: Custom Analysis\n  description: Description of what this shows\n\nsections:\n  my_section:\n    title: \"Section Title\"\n    charts:\n      - type: bar\n        title: \"Chart Title\"\n        dataset: my_data.csv\n        x: category\n        y: value\n        color: dataset\n        axis_labels:\n          category: \"Category Name\"\n          value: \"Value Label\"\n</code></pre>"},{"location":"dashboard/#chart-types","title":"Chart Types","text":"<p>Supported chart types: - <code>bar</code> - Bar charts (most common) - <code>line</code> - Line charts - <code>scatter</code> - Scatter plots</p>"},{"location":"dashboard/#faceting","title":"Faceting","text":"<p>Split charts across multiple panels:</p> <pre><code>- type: bar\n  title: \"My Chart\"\n  dataset: data.csv\n  x: category\n  y: value\n  color: subcategory\n  facet: dataset  # Creates separate panel for each dataset\n</code></pre>"},{"location":"dashboard/#data-requirements","title":"Data Requirements","text":"<p>The dashboard reads CSV files from <code>outputs/dashboard/</code> directory. Each CSV must have:</p> <ol> <li>Column for x-axis (categories, modes, etc.)</li> <li>Column for y-axis (counts, shares, averages, etc.)</li> <li>dataset column (to distinguish between model runs)</li> </ol> <p>Example CSV structure:</p> <pre><code>trip_mode,trips,share,dataset\nDrive Alone,1000000,45.2,2023 TM2.2 v05\nCarpool,300000,13.6,2023 TM2.2 v05\nTransit,200000,9.0,2023 TM2.2 v05\nDrive Alone,950000,43.8,2015 TM2.2 Sprint 04\n...\n</code></pre>"},{"location":"dashboard/#troubleshooting","title":"Troubleshooting","text":""},{"location":"dashboard/#no-data-available","title":"\"No data available\"","text":"<p>Ensure CSV files exist in <code>outputs/dashboard/</code> and column names match the YAML configuration.</p>"},{"location":"dashboard/#port-already-in-use","title":"Port already in use","text":"<p>Use a different port: <pre><code>streamlit run dashboard/dashboard_app.py --server.port 8503\n</code></pre></p>"},{"location":"dashboard/#charts-not-updating","title":"Charts not updating","text":"<p>Streamlit auto-reloads when files change. If not working, refresh the browser (F5).</p>"},{"location":"dashboard/#missing-tabs","title":"Missing tabs","text":"<p>Check that dashboard YAML files are in <code>dashboard/</code> directory (not <code>outputs/dashboard/</code>).</p>"},{"location":"dashboard/#deployment","title":"Deployment","text":"<p>The dashboard auto-deploys to Streamlit Cloud when changes are pushed to the main branch on GitHub.</p> <p>Live URL: https://tm2-validation-dashboard.streamlit.app/</p>"},{"location":"dashboard/#manual-deployment","title":"Manual Deployment","text":"<p>To deploy your own instance:</p> <ol> <li>Create a Streamlit Cloud account</li> <li>Connect your GitHub repository</li> <li>Set main file: <code>tm2py_utils/summary/validation/dashboard/dashboard_app.py</code></li> <li>Deploy!</li> </ol>"},{"location":"dashboard/#next-steps","title":"Next Steps","text":"<ul> <li>Generate Summaries to populate dashboard data</li> <li>Customize Configuration to add new analyses</li> </ul>"},{"location":"install/","title":"Installation Guide","text":""},{"location":"install/#prerequisites","title":"Prerequisites","text":"<ul> <li>Python: 3.9 or higher</li> <li>Conda: Anaconda or Miniconda</li> <li>Git: For cloning the repository</li> </ul>"},{"location":"install/#installation-steps","title":"Installation Steps","text":""},{"location":"install/#1-clone-the-repository","title":"1. Clone the Repository","text":"<pre><code>git clone https://github.com/BayAreaMetro/tm2py-utils.git\ncd tm2py-utils\n</code></pre>"},{"location":"install/#2-create-conda-environment","title":"2. Create Conda Environment","text":"<pre><code># Create environment from environment.yml (if available)\nconda env create -f environment.yml\n\n# Or create manually\nconda create -n tm2py-utils python=3.9 pandas numpy pyyaml\nconda activate tm2py-utils\n</code></pre>"},{"location":"install/#3-install-dependencies","title":"3. Install Dependencies","text":"<pre><code># Install required packages\npip install -r requirements.txt\n\n# Install additional dashboard dependencies\npip install streamlit plotly\n</code></pre>"},{"location":"install/#4-install-tm2py-utils","title":"4. Install tm2py-utils","text":"<pre><code># Install in development mode\npip install -e .\n</code></pre>"},{"location":"install/#verifying-installation","title":"Verifying Installation","text":"<p>Test that the installation works:</p> <pre><code># Check package is importable\npython -c \"import tm2py_utils; print('tm2py-utils installed successfully!')\"\n\n# List available summaries\ncd tm2py_utils/summary/validation\npython list_summaries.py\n</code></pre>"},{"location":"install/#optional-set-up-data-paths","title":"Optional: Set Up Data Paths","text":"<p>Edit <code>tm2py_utils/summary/validation/validation_config.yaml</code> to point to your model output directories:</p> <pre><code>input_directories:\n  - path: \"E:\\\\model_runs\\\\2023-tm22-dev-version-05\\\\ctramp_output\"\n    name: \"2023_version_05\"\n    display_name: \"2023 TM2.2 v05\"\n</code></pre>"},{"location":"install/#troubleshooting","title":"Troubleshooting","text":""},{"location":"install/#import-errors","title":"Import Errors","text":"<p>If you get <code>ModuleNotFoundError</code>, ensure you've activated the conda environment:</p> <pre><code>conda activate tm2py-utils\n</code></pre>"},{"location":"install/#streamlit-not-found","title":"Streamlit Not Found","text":"<p>If <code>streamlit</code> command is not recognized:</p> <pre><code>pip install streamlit\n</code></pre>"},{"location":"install/#permission-errors","title":"Permission Errors","text":"<p>On Windows, you may need to run PowerShell as Administrator for some operations.</p>"},{"location":"install/#next-steps","title":"Next Steps","text":"<ul> <li>Run the Dashboard</li> <li>Generate Summaries</li> <li>Configure Analysis</li> </ul>"},{"location":"summaries/","title":"Summary Generation System","text":"<p>The tm2py-utils summary system generates aggregated statistics from CTRAMP model outputs for validation and comparison.</p>"},{"location":"summaries/#overview","title":"Overview","text":"<p>The system provides: - 34 configured summaries (21 core + 13 validation) - Config-driven - Add summaries via YAML, no Python coding - Flexible filtering - Generate core, validation, or all summaries - Multiple output formats - CSV, Parquet</p>"},{"location":"summaries/#quick-start","title":"Quick Start","text":""},{"location":"summaries/#view-configured-summaries","title":"View Configured Summaries","text":"<pre><code>cd tm2py_utils/summary/validation\npython list_summaries.py\n</code></pre>"},{"location":"summaries/#generate-all-summaries","title":"Generate All Summaries","text":"<pre><code>python -m tm2py_utils.summary.validation.summaries.run_all \\\n  --config validation_config.yaml\n</code></pre>"},{"location":"summaries/#generate-core-summaries-only","title":"Generate Core Summaries Only","text":"<p>Edit <code>validation_config.yaml</code>: <pre><code>generate_summaries: \"core\"\n</code></pre></p> <p>Then run: <pre><code>python -m tm2py_utils.summary.validation.summaries.run_all \\\n  --config validation_config.yaml\n</code></pre></p>"},{"location":"summaries/#summary-types","title":"Summary Types","text":""},{"location":"summaries/#core-summaries-21","title":"Core Summaries (21)","text":"<p>Essential analysis matching legacy <code>core_summaries.py</code> outputs:</p> <p>Households: - Auto ownership (regional, by income)</p> <p>Activity Patterns (CDAP): - Overall distribution - By person type, age, county, auto ownership</p> <p>Tours: - Frequency by purpose - Mode choice (overall and by purpose) - Start/end times</p> <p>Trips: - Mode choice (overall and by purpose) - Purpose distribution - Mode by time period - Distance and travel time (detailed)</p> <p>Commute: - Journey to work (distance/time by OD) - Journey to work by mode</p>"},{"location":"summaries/#validation-summaries-13","title":"Validation Summaries (13)","text":"<p>Extended analysis for detailed validation and dashboard:</p> <p>Households: - Auto ownership by household size - Auto ownership by household size (ACS-comparable) - Auto ownership by county</p> <p>Tours: - Mode choice (aggregated categories) - Mode by purpose (aggregated) - Distance distribution (binned) - Duration distribution (binned)</p> <p>Trips: - Mode choice (aggregated categories) - Mode by purpose (aggregated) - Departure time distribution - Distance distribution (binned) - Duration distribution (binned)</p>"},{"location":"summaries/#configuration","title":"Configuration","text":""},{"location":"summaries/#setting-summary-filter","title":"Setting Summary Filter","text":"<p>Edit <code>validation_config.yaml</code>:</p> <pre><code># Options: \"all\", \"core\", \"validation\"\ngenerate_summaries: \"core\"\n</code></pre>"},{"location":"summaries/#adding-custom-summaries","title":"Adding Custom Summaries","text":"<p>Add to <code>custom_summaries</code> section in <code>validation_config.yaml</code>:</p> <pre><code>custom_summaries:\n  - name: \"my_new_summary\"\n    summary_type: \"validation\"  # or \"core\"\n    description: \"What this summarizes\"\n    data_source: \"individual_trips\"  # or households, tours, persons, etc.\n    group_by: [\"trip_mode\", \"tour_purpose\"]\n    weight_field: \"sample_rate\"\n    count_name: \"trips\"\n    share_within: \"tour_purpose\"  # Calculate shares within groups\n</code></pre>"},{"location":"summaries/#available-data-sources","title":"Available Data Sources","text":"<ul> <li><code>households</code> - Household-level data</li> <li><code>persons</code> - Person-level data</li> <li><code>individual_tours</code> - Tour-level data</li> <li><code>individual_trips</code> - Trip-level data</li> <li><code>workplace_school</code> - Work/school location choice</li> </ul>"},{"location":"summaries/#aggregation-options","title":"Aggregation Options","text":"<p>Simple count: <pre><code>group_by: \"trip_mode\"\ncount_name: \"trips\"\n</code></pre></p> <p>Multiple aggregations: <pre><code>group_by: [\"income_category_bin\", \"trip_mode\"]\naggregations:\n  trips: \"count\"\n  avg_distance: {\"column\": \"trip_distance_miles\", \"agg\": \"mean\"}\n  total_time: {\"column\": \"trip_time_minutes\", \"agg\": \"sum\"}\n</code></pre></p> <p>Share calculations: <pre><code>group_by: [\"tour_purpose\", \"tour_mode\"]\nshare_within: \"tour_purpose\"  # Each purpose sums to 100%\n</code></pre></p>"},{"location":"summaries/#binning-continuous-variables","title":"Binning Continuous Variables","text":"<pre><code>group_by: [\"income_category_bin\", \"trip_mode\"]\nbins:\n  income_category:\n    breaks: [0, 30000, 60000, 100000, 150000, 1000000000]\n    labels: ['&lt;30K', '30-60K', '60-100K', '100-150K', '150K+']\n</code></pre>"},{"location":"summaries/#output-files","title":"Output Files","text":"<p>Summaries are written to <code>outputs/</code> directory:</p> <pre><code>outputs/\n\u251c\u2500\u2500 auto_ownership_regional.csv\n\u251c\u2500\u2500 tour_mode_choice.csv\n\u251c\u2500\u2500 trip_distance.csv\n\u2514\u2500\u2500 ...\n</code></pre>"},{"location":"summaries/#csv-format","title":"CSV Format","text":"<p>Example output:</p> <pre><code>tour_mode,tours,share,dataset\nDrive Alone,450000,42.5,2023 TM2.2 v05\nCarpool,180000,17.0,2023 TM2.2 v05\nTransit,95000,9.0,2023 TM2.2 v05\n...\n</code></pre>"},{"location":"summaries/#deployment-workflow","title":"Deployment Workflow","text":""},{"location":"summaries/#using-the-deployment-script","title":"Using the Deployment Script","text":"<pre><code>cd tm2py_utils/summary/validation\n\n# Generate all summaries and copy to dashboard\npython run_and_deploy_dashboard.py --config validation_config.yaml\n\n# Generate only core summaries\npython run_and_deploy_dashboard.py --config validation_config.yaml --summaries core\n\n# Generate and launch dashboard\npython run_and_deploy_dashboard.py --config validation_config.yaml --launch-dashboard\n</code></pre>"},{"location":"summaries/#using-batch-script-windows","title":"Using Batch Script (Windows)","text":"<p>Double-click <code>deploy_dashboard.bat</code> for interactive menu:</p> <ol> <li>Generate ALL summaries</li> <li>Generate CORE summaries only</li> <li>Generate VALIDATION summaries only</li> <li>Copy existing summaries (skip generation)</li> <li>Generate and LAUNCH dashboard</li> </ol>"},{"location":"summaries/#manual-steps","title":"Manual Steps","text":"<pre><code># 1. Generate summaries\npython -m tm2py_utils.summary.validation.summaries.run_all \\\n  --config validation_config.yaml\n\n# 2. Copy to dashboard folder\ncp outputs/*.csv outputs/dashboard/\n\n# 3. Launch dashboard\nstreamlit run dashboard/dashboard_app.py --server.port 8501\n</code></pre>"},{"location":"summaries/#data-model","title":"Data Model","text":"<p>Column mappings are defined in <code>data_model/ctramp_data_model.yaml</code>:</p> <pre><code>individual_trips:\n  file_pattern: \"indivTripData_{iteration}.csv\"\n  columns:\n    trip_mode: \"trip_mode\"\n    tour_purpose: \"tour_purpose\"\n    trip_distance: \"trip_distance_miles\"\n    depart_period: \"depart_period\"\n</code></pre> <p>Variable labels in <code>variable_labels.yaml</code>:</p> <pre><code>trip_mode: \"Trip Mode\"\ntour_purpose: \"Tour Purpose\"\nincome_category_bin: \"Income Category\"\n</code></pre>"},{"location":"summaries/#performance","title":"Performance","text":"<p>Typical runtimes on a standard laptop:</p> <ul> <li>Core summaries only: ~5-10 minutes</li> <li>All summaries: ~15-20 minutes</li> <li>Memory usage: ~2-4 GB</li> </ul> <p>For large model runs, consider: - Generating core summaries only for quick checks - Running full validation suite overnight</p>"},{"location":"summaries/#troubleshooting","title":"Troubleshooting","text":""},{"location":"summaries/#no-summaries-generated","title":"No summaries generated","text":"<p>Check that input directories in <code>validation_config.yaml</code> exist and contain CTRAMP output files: - <code>indivTripData_1.csv</code> - <code>householdData_1.csv</code> - <code>indivTourData_1.csv</code> - etc.</p>"},{"location":"summaries/#column-not-found-errors","title":"Column not found errors","text":"<p>Check <code>ctramp_data_model.yaml</code> for correct column mappings.</p>"},{"location":"summaries/#memory-errors","title":"Memory errors","text":"<p>Reduce the number of input directories or process one at a time.</p>"},{"location":"summaries/#wrong-summaries-generated","title":"Wrong summaries generated","text":"<p>Run <code>python list_summaries.py</code> to see what will be generated based on current config.</p>"},{"location":"summaries/#next-steps","title":"Next Steps","text":"<ul> <li>Configure Dashboard to visualize summaries</li> <li>Customize Configuration for your analysis needs</li> <li>See Consolidation Proposal for system architecture</li> </ul>"},{"location":"validation-system/","title":"Validation Summary System","text":"<p>Complete guide to creating, configuring, and deploying validation summaries for Travel Model Two analysis.</p>"},{"location":"validation-system/#overview","title":"Overview","text":"<p>The validation summary system provides a flexible, config-driven framework for: - Generating statistics from CTRAMP model runs - Comparing model outputs to observed data (ACS, CTPP, travel surveys) - Creating interactive dashboards for validation - Managing multiple scenarios and datasets</p> <p>Key Features: - No coding required - Define summaries in YAML - 34 pre-configured summaries (21 core + 13 validation) - Flexible aggregation - Group, bin, weight, and filter data - Multiple data sources - Model runs, surveys, census data - Interactive visualization - Streamlit dashboard with 8 tabs</p>"},{"location":"validation-system/#quick-start","title":"Quick Start","text":""},{"location":"validation-system/#generate-summaries-from-model-run","title":"Generate Summaries from Model Run","text":"<pre><code>cd tm2py_utils/summary/validation\n\n# Edit validation_config.yaml to point to your model outputs\n# Then generate summaries\npython -m tm2py_utils.summary.validation.summaries.run_all \\\n  --config validation_config.yaml\n</code></pre>"},{"location":"validation-system/#deploy-dashboard","title":"Deploy Dashboard","text":"<pre><code># Copy summaries and launch dashboard\npython run_and_deploy_dashboard.py \\\n  --config validation_config.yaml \\\n  --launch-dashboard\n</code></pre> <p>Visit http://localhost:8501</p>"},{"location":"validation-system/#1-working-with-model-run-data","title":"1. Working with Model Run Data","text":""},{"location":"validation-system/#pointing-to-new-model-outputs","title":"Pointing to New Model Outputs","text":"<p>Edit <code>validation_config.yaml</code> to add your model run directory:</p> <pre><code>input_directories:\n  - path: \"C:/model_runs/2023_base_year\"\n    label: \"2023 Base Year\"\n\n  - path: \"C:/model_runs/2050_plan\"\n    label: \"2050 RTP\"\n</code></pre> <p>Required files in directory: - <code>householdData_1.csv</code> - Household attributes - <code>personData_1.csv</code> - Person attributes - <code>indivTourData_1.csv</code> - Tour-level data - <code>indivTripData_1.csv</code> - Trip-level data - <code>wsLocResults.csv</code> - Work/school locations (optional)</p>"},{"location":"validation-system/#creating-summaries-from-model-data","title":"Creating Summaries from Model Data","text":""},{"location":"validation-system/#example-1-simple-trip-mode-choice","title":"Example 1: Simple Trip Mode Choice","text":"<pre><code>custom_summaries:\n  - name: \"trip_mode_choice\"\n    summary_type: \"core\"\n    description: \"Trip mode choice distribution\"\n    data_source: \"individual_trips\"\n    group_by: \"trip_mode\"\n    weight_field: \"sample_rate\"\n    count_name: \"trips\"\n</code></pre> <p>Output: <code>trip_mode_choice.csv</code> <pre><code>trip_mode,trips,share,dataset\nDrive Alone,450000,42.5,2023 Base Year\nCarpool,180000,17.0,2023 Base Year\nTransit,95000,9.0,2023 Base Year\n...\n</code></pre></p>"},{"location":"validation-system/#example-2-tours-by-purpose-and-mode","title":"Example 2: Tours by Purpose and Mode","text":"<pre><code>custom_summaries:\n  - name: \"tour_mode_by_purpose\"\n    summary_type: \"core\"\n    description: \"Tour mode choice by purpose\"\n    data_source: \"individual_tours\"\n    group_by: [\"tour_purpose\", \"tour_mode\"]\n    weight_field: \"sample_rate\"\n    aggregations:\n      tours: \"count\"\n    share_within: \"tour_purpose\"\n</code></pre> <p>Output: Each purpose shows mode shares summing to 100%</p>"},{"location":"validation-system/#example-3-trip-distance-with-multiple-metrics","title":"Example 3: Trip Distance with Multiple Metrics","text":"<pre><code>custom_summaries:\n  - name: \"trip_distance_stats\"\n    summary_type: \"validation\"\n    description: \"Trip distance statistics by mode\"\n    data_source: \"individual_trips\"\n    group_by: \"trip_mode\"\n    weight_field: \"sample_rate\"\n    aggregations:\n      trips: \"count\"\n      avg_distance:\n        column: \"trip_distance_miles\"\n        agg: \"mean\"\n      total_vmt:\n        column: \"trip_distance_miles\"\n        agg: \"sum\"\n      max_distance:\n        column: \"trip_distance_miles\"\n        agg: \"max\"\n</code></pre>"},{"location":"validation-system/#available-data-sources","title":"Available Data Sources","text":"Data Source File Pattern Common Uses <code>households</code> <code>householdData_1.csv</code> Auto ownership, household size, income <code>persons</code> <code>personData_1.csv</code> Person type, age, employment <code>individual_tours</code> <code>indivTourData_1.csv</code> Tour frequency, mode choice, timing <code>individual_trips</code> <code>indivTripData_1.csv</code> Trip mode, purpose, distance, time <code>workplace_school</code> <code>wsLocResults.csv</code> Journey to work, commute patterns"},{"location":"validation-system/#2-working-with-other-data-sources-acs-ctpp-surveys","title":"2. Working with Other Data Sources (ACS, CTPP, Surveys)","text":""},{"location":"validation-system/#overview_1","title":"Overview","text":"<p>Observed data from census sources (ACS, CTPP) and household travel surveys must be preprocessed to match the model output format before use in the validation system.</p> <p>Key requirements for all observed data: - Include <code>dataset</code> column with source name (e.g., \"ACS 2019\", \"2022 Travel Survey\") - Use same column names as model outputs (e.g., <code>trip_mode</code>, not <code>mode</code>) - Match model geography (regional, county, TAZ) - Pre-aggregate to summary level (counts/shares)</p>"},{"location":"validation-system/#adding-preprocessed-observed-data","title":"Adding Preprocessed Observed Data","text":"<p>Once your data is preprocessed to match model format:</p>"},{"location":"validation-system/#step-1-save-preprocessed-files","title":"Step 1: Save Preprocessed Files","text":"<p>Example: <code>survey_trip_mode.csv</code> <pre><code>trip_mode,trips,share,dataset\nDrive Alone,1250,45.2,2022 Travel Survey\nCarpool,380,13.7,2022 Travel Survey\nTransit,295,10.7,2022 Travel Survey\nWalk,520,18.8,2022 Travel Survey\nBike,320,11.6,2022 Travel Survey\n</code></pre></p>"},{"location":"validation-system/#step-2-configure-as-observed-data-source","title":"Step 2: Configure as Observed Data Source","text":"<p>Add to <code>validation_config.yaml</code>:</p> <pre><code>observed_data_sources:\n  - name: \"2022 Travel Survey\"\n    directory: \"C:/data/travel_survey_2022\"\n    files:\n      trip_mode_choice: \"survey_trip_mode.csv\"\n      tour_mode_choice: \"survey_tour_mode.csv\"\n      trip_distance: \"survey_trip_distance.csv\"\n</code></pre>"},{"location":"validation-system/#step-3-reference-in-summary-definition","title":"Step 3: Reference in Summary Definition","text":"<pre><code>custom_summaries:\n  - name: \"trip_mode_choice\"\n    data_source: \"individual_trips\"\n    group_by: \"trip_mode\"\n    weight_field: \"sample_rate\"\n    count_name: \"trips\"\n    observed_data: \"2022 Travel Survey\"\n    observed_file: \"trip_mode_choice\"\n</code></pre> <p>Result: Model and observed data combined in one CSV for side-by-side comparison in dashboard.</p>"},{"location":"validation-system/#3-preprocessing-acs-and-ctpp-data","title":"3. Preprocessing ACS and CTPP Data","text":"<p>Census data (ACS, CTPP) and household travel surveys require preprocessing to match model geography and format. Below are examples of preprocessing workflows.</p>"},{"location":"validation-system/#preprocessing-acs-data","title":"Preprocessing ACS Data","text":""},{"location":"validation-system/#example-auto-ownership-from-acs","title":"Example: Auto Ownership from ACS","text":"<p>Step 1: Download ACS Table B08201</p> <p>Use Census API or data.census.gov: - Table: B08201 (Household Size by Vehicles Available) - Geography: Counties in Bay Area</p> <p>Step 2: Aggregate to Model Geography</p> <p>Python preprocessing script:</p> <pre><code>import pandas as pd\n\n# Load ACS data\nacs = pd.read_csv(\"acs_b08201_raw.csv\")\n\n# Aggregate to region\nregional = acs.groupby('vehicles_available').agg({\n    'estimate': 'sum',\n    'moe': lambda x: (x**2).sum()**0.5  # Combine margins of error\n}).reset_index()\n\n# Calculate shares\nregional['share'] = regional['estimate'] / regional['estimate'].sum() * 100\n\n# Format for validation system\noutput = pd.DataFrame({\n    'auto_ownership': regional['vehicles_available'].map({\n        0: '0 autos',\n        1: '1 auto',\n        2: '2 autos',\n        3: '3+ autos'\n    }),\n    'households': regional['estimate'],\n    'share': regional['share'],\n    'dataset': 'ACS 2019'\n})\n\noutput.to_csv(\"acs_auto_ownership_regional.csv\", index=False)\n</code></pre> <p>Step 3: Configure as Observed Data</p> <pre><code>observed_data_sources:\n  - name: \"ACS 2019\"\n    directory: \"C:/data/acs_2019\"\n    files:\n      auto_ownership_regional: \"acs_auto_ownership_regional.csv\"\n      auto_ownership_by_size: \"acs_auto_by_size.csv\"\n</code></pre>"},{"location":"validation-system/#preprocessing-ctpp-data","title":"Preprocessing CTPP Data","text":""},{"location":"validation-system/#example-journey-to-work","title":"Example: Journey to Work","text":"<p>Step 1: Download CTPP Part 3</p> <ul> <li>Table: Means of Transportation to Work</li> <li>Geography: TAZ-to-TAZ or County-to-County</li> </ul> <p>Step 2: Process CTPP Data</p> <pre><code>import pandas as pd\n\n# Load CTPP data\nctpp = pd.read_csv(\"ctpp_journey_to_work.csv\")\n\n# Aggregate modes to match model categories\nmode_mapping = {\n    'Car, truck, or van - drove alone': 'Drive Alone',\n    'Car, truck, or van - carpooled': 'Carpool',\n    'Public transportation': 'Transit',\n    'Walked': 'Walk',\n    'Bicycle': 'Bike',\n    'Taxicab, motorcycle, or other means': 'Other'\n}\n\nctpp['mode'] = ctpp['mode_detailed'].map(mode_mapping)\n\n# Aggregate to region\nregional = ctpp.groupby('mode').agg({\n    'workers': 'sum'\n}).reset_index()\n\nregional['share'] = regional['workers'] / regional['workers'].sum() * 100\nregional['dataset'] = 'CTPP 2012-2016'\n\n# Save\nregional.to_csv(\"ctpp_journey_to_work_mode.csv\", index=False)\n</code></pre>"},{"location":"validation-system/#geography-crosswalks","title":"Geography Crosswalks","text":"<p>For TAZ-level comparisons, create crosswalks:</p> <pre><code># Map Census tracts to model TAZs\ncrosswalk = pd.read_csv(\"tract_to_taz_crosswalk.csv\")\n\nacs_tract = pd.read_csv(\"acs_by_tract.csv\")\n\n# Apportion to TAZ based on population weights\nacs_taz = acs_tract.merge(crosswalk, on='tract')\nacs_taz['value'] = acs_taz['value'] * acs_taz['weight']\nacs_taz = acs_taz.groupby('taz')['value'].sum().reset_index()\n</code></pre>"},{"location":"validation-system/#4-creating-custom-aggregations","title":"4. Creating Custom Aggregations","text":""},{"location":"validation-system/#defining-new-mode-groups","title":"Defining New Mode Groups","text":""},{"location":"validation-system/#step-1-map-detailed-modes-to-groups","title":"Step 1: Map Detailed Modes to Groups","text":"<p>Create aggregation in preprocessing or post-processing:</p> <pre><code># In validation_config.yaml, reference aggregated column\ncustom_summaries:\n  - name: \"tour_mode_aggregated\"\n    data_source: \"individual_tours\"\n    group_by: \"tour_mode_agg\"  # Pre-created aggregated column\n    count_name: \"tours\"\n</code></pre>"},{"location":"validation-system/#step-2-create-aggregated-column","title":"Step 2: Create Aggregated Column","text":"<p>Add to data model processing (if not in CTRAMP output):</p> <pre><code># In custom summary logic or preprocessing\nmode_aggregation = {\n    'DRIVEALONEFREE': 'Drive Alone',\n    'DRIVEALONEPAY': 'Drive Alone',\n    'SHARED2FREE': 'Carpool',\n    'SHARED2PAY': 'Carpool',\n    'SHARED3FREE': 'Carpool',\n    'SHARED3PAY': 'Carpool',\n    'WALK_LOC': 'Transit',\n    'WALK_LRF': 'Transit',\n    'WALK_EXP': 'Transit',\n    'WALK_HVY': 'Transit',\n    'WALK_COM': 'Transit',\n    'WALK': 'Walk',\n    'BIKE': 'Bike'\n}\n\ndf['tour_mode_agg'] = df['tour_mode'].map(mode_aggregation)\n</code></pre>"},{"location":"validation-system/#aggregating-income-categories","title":"Aggregating Income Categories","text":"<pre><code>custom_summaries:\n  - name: \"auto_ownership_by_income_group\"\n    data_source: \"households\"\n    group_by: [\"income_group\", \"auto_ownership\"]\n    bins:\n      income:\n        breaks: [0, 60000, 150000, 1000000000]\n        labels: ['Low', 'Medium', 'High']\n        bin_column: \"income_group\"\n</code></pre>"},{"location":"validation-system/#custom-purpose-groups","title":"Custom Purpose Groups","text":"<p>Group related purposes:</p> <pre><code>custom_summaries:\n  - name: \"trips_by_purpose_group\"\n    data_source: \"individual_trips\"\n    group_by: \"purpose_group\"\n    # Assumes purpose_group pre-created:\n    # Work/School, Shopping/Maintenance, Social/Recreation\n</code></pre>"},{"location":"validation-system/#5-creating-custom-bins","title":"5. Creating Custom Bins","text":"<p>Binning converts continuous variables to categories for analysis.</p>"},{"location":"validation-system/#distance-bins","title":"Distance Bins","text":"<pre><code>custom_summaries:\n  - name: \"trips_by_distance_bin\"\n    data_source: \"individual_trips\"\n    group_by: [\"distance_bin\", \"trip_mode\"]\n    weight_field: \"sample_rate\"\n    count_name: \"trips\"\n    bins:\n      distance:\n        breaks: [0, 1, 3, 5, 10, 20, 50, 1000]\n        labels: ['&lt;1mi', '1-3mi', '3-5mi', '5-10mi', '10-20mi', '20-50mi', '50+mi']\n        source_column: \"trip_distance_miles\"\n        bin_column: \"distance_bin\"\n</code></pre> <p>Parameters: - <code>breaks</code>: Bin boundaries (left-inclusive, right-exclusive) - <code>labels</code>: Display names for bins - <code>source_column</code>: Column to bin (default: bin name) - <code>bin_column</code>: Output column name (default: bin name + \"_bin\")</p>"},{"location":"validation-system/#time-of-day-bins","title":"Time of Day Bins","text":"<pre><code>bins:\n  time_period:\n    breaks: [0, 6, 9, 15, 19, 24]\n    labels: ['Early AM', 'AM Peak', 'Midday', 'PM Peak', 'Evening']\n    source_column: \"departure_hour\"\n</code></pre>"},{"location":"validation-system/#age-bins","title":"Age Bins","text":"<pre><code>bins:\n  age_category:\n    breaks: [0, 18, 25, 35, 50, 65, 120]\n    labels: ['0-17', '18-24', '25-34', '35-49', '50-64', '65+']\n    source_column: \"age\"\n</code></pre>"},{"location":"validation-system/#income-quartiles","title":"Income Quartiles","text":"<pre><code>bins:\n  income_quartile:\n    breaks: [0, 35000, 70000, 120000, 1000000000]\n    labels: ['Q1', 'Q2', 'Q3', 'Q4']\n    source_column: \"household_income\"\n</code></pre>"},{"location":"validation-system/#multi-dimensional-binning","title":"Multi-Dimensional Binning","text":"<pre><code>custom_summaries:\n  - name: \"trip_distance_time_matrix\"\n    group_by: [\"distance_bin\", \"time_bin\", \"trip_mode\"]\n    bins:\n      distance:\n        breaks: [0, 5, 10, 20, 1000]\n        labels: ['&lt;5mi', '5-10mi', '10-20mi', '20+mi']\n      time:\n        breaks: [0, 15, 30, 60, 1000]\n        labels: ['&lt;15min', '15-30min', '30-60min', '60+min']\n        source_column: \"trip_time_minutes\"\n</code></pre>"},{"location":"validation-system/#6-dashboard-visualization","title":"6. Dashboard Visualization","text":""},{"location":"validation-system/#creating-dashboard-yaml-files","title":"Creating Dashboard YAML Files","text":"<p>Dashboard tabs are defined in <code>dashboard/dashboard-N-title.yaml</code>.</p>"},{"location":"validation-system/#step-1-create-dashboard-file","title":"Step 1: Create Dashboard File","text":"<p>Example: <code>dashboard-8-distance-analysis.yaml</code></p> <pre><code>title: \"Distance Analysis\"\ndescription: \"Trip and tour distance patterns by mode and purpose\"\n\nsections:\n  - title: \"Trip Distance Distribution\"\n    layout: \"two_column\"\n    charts:\n      - type: \"bar\"\n        title: \"Trips by Distance\"\n        data_file: \"trips_by_distance_bin.csv\"\n        x: \"distance_bin\"\n        y: \"trips\"\n        color: \"dataset\"\n        orientation: \"v\"\n        category_orders:\n          distance_bin: ['&lt;1mi', '1-3mi', '3-5mi', '5-10mi', '10-20mi', '20-50mi', '50+mi']\n\n      - type: \"bar\"\n        title: \"Mode Share by Distance\"\n        data_file: \"trip_mode_by_distance.csv\"\n        x: \"distance_bin\"\n        y: \"share\"\n        color: \"trip_mode\"\n        orientation: \"v\"\n        barmode: \"stack\"\n\n  - title: \"Distance by Mode\"\n    layout: \"single_column\"\n    charts:\n      - type: \"box\"\n        title: \"Distance Distribution by Mode\"\n        data_file: \"trip_distance_detailed.csv\"\n        x: \"trip_mode\"\n        y: \"trip_distance_miles\"\n        color: \"dataset\"\n</code></pre>"},{"location":"validation-system/#step-2-ensure-required-csvs-exist","title":"Step 2: Ensure Required CSVs Exist","text":"<p>Configure summaries to generate needed files:</p> <pre><code># In validation_config.yaml\ncustom_summaries:\n  - name: \"trips_by_distance_bin\"\n    # ... configuration\n\n  - name: \"trip_mode_by_distance\"\n    # ... configuration\n\n  - name: \"trip_distance_detailed\"\n    # ... configuration\n</code></pre>"},{"location":"validation-system/#step-3-test-dashboard","title":"Step 3: Test Dashboard","text":"<pre><code>cd tm2py_utils/summary/validation\n\n# Generate summaries\npython run_and_deploy_dashboard.py --config validation_config.yaml\n\n# Dashboard auto-discovers new YAML files\n# Visit http://localhost:8501\n</code></pre>"},{"location":"validation-system/#chart-types-reference","title":"Chart Types Reference","text":""},{"location":"validation-system/#bar-chart","title":"Bar Chart","text":"<pre><code>- type: \"bar\"\n  title: \"Chart Title\"\n  data_file: \"summary.csv\"\n  x: \"category\"\n  y: \"value\"\n  color: \"dataset\"\n  orientation: \"h\"  # or \"v\"\n  barmode: \"group\"  # or \"stack\", \"relative\"\n</code></pre>"},{"location":"validation-system/#line-chart","title":"Line Chart","text":"<pre><code>- type: \"line\"\n  title: \"Trend Over Time\"\n  data_file: \"trend.csv\"\n  x: \"year\"\n  y: \"value\"\n  color: \"category\"\n</code></pre>"},{"location":"validation-system/#scatter-plot","title":"Scatter Plot","text":"<pre><code>- type: \"scatter\"\n  title: \"Correlation\"\n  data_file: \"scatter.csv\"\n  x: \"variable1\"\n  y: \"variable2\"\n  color: \"group\"\n  size: \"weight\"\n</code></pre>"},{"location":"validation-system/#box-plot","title":"Box Plot","text":"<pre><code>- type: \"box\"\n  title: \"Distribution\"\n  data_file: \"distribution.csv\"\n  x: \"category\"\n  y: \"value\"\n  color: \"dataset\"\n</code></pre>"},{"location":"validation-system/#faceting-small-multiples","title":"Faceting (Small Multiples)","text":"<p>Create subplots for each category:</p> <pre><code>- type: \"bar\"\n  title: \"Mode Share by County\"\n  data_file: \"mode_by_county.csv\"\n  x: \"trip_mode\"\n  y: \"share\"\n  color: \"dataset\"\n  facet_col: \"county\"\n  facet_col_wrap: 3  # 3 columns of subplots\n</code></pre>"},{"location":"validation-system/#custom-category-ordering","title":"Custom Category Ordering","text":"<pre><code>category_orders:\n  trip_mode: [\"Walk\", \"Bike\", \"Transit\", \"Carpool\", \"Drive Alone\"]\n  tour_purpose: [\"Work\", \"School\", \"Shopping\", \"Maintenance\", \"Eating Out\", \"Social\"]\n  county: [\"San Francisco\", \"Alameda\", \"Contra Costa\", \"Santa Clara\", \"San Mateo\"]\n</code></pre>"},{"location":"validation-system/#custom-labels","title":"Custom Labels","text":"<pre><code>labels:\n  trip_mode: \"Travel Mode\"\n  trips: \"Number of Trips\"\n  share: \"Mode Share (%)\"\n  distance_bin: \"Distance Category\"\n</code></pre>"},{"location":"validation-system/#7-deploying-the-dashboard","title":"7. Deploying the Dashboard","text":""},{"location":"validation-system/#local-deployment","title":"Local Deployment","text":""},{"location":"validation-system/#option-1-full-workflow","title":"Option 1: Full Workflow","text":"<pre><code>cd tm2py_utils/summary/validation\n\n# Generate all summaries and launch\npython run_and_deploy_dashboard.py \\\n  --config validation_config.yaml \\\n  --launch-dashboard\n</code></pre>"},{"location":"validation-system/#option-2-batch-script-windows","title":"Option 2: Batch Script (Windows)","text":"<pre><code># Double-click deploy_dashboard.bat\n# Select option 5: \"Generate and LAUNCH dashboard\"\n</code></pre>"},{"location":"validation-system/#option-3-manual-steps","title":"Option 3: Manual Steps","text":"<pre><code># 1. Generate summaries\npython -m tm2py_utils.summary.validation.summaries.run_all \\\n  --config validation_config.yaml\n\n# 2. Copy to dashboard folder\npython run_and_deploy_dashboard.py \\\n  --config validation_config.yaml \\\n  --skip-generation\n\n# 3. Launch dashboard\nstreamlit run dashboard/dashboard_app.py --server.port 8501\n</code></pre>"},{"location":"validation-system/#streamlit-cloud-deployment","title":"Streamlit Cloud Deployment","text":""},{"location":"validation-system/#step-1-push-to-github","title":"Step 1: Push to GitHub","text":"<pre><code>git add .\ngit commit -m \"Update validation dashboard\"\ngit push origin main\n</code></pre>"},{"location":"validation-system/#step-2-deploy-on-streamlit-cloud","title":"Step 2: Deploy on Streamlit Cloud","text":"<ol> <li>Go to https://share.streamlit.io</li> <li>Click \"New app\"</li> <li>Select repository: <code>BayAreaMetro/tm2py-utils</code></li> <li>Set branch: <code>main</code></li> <li>Set main file path: <code>tm2py_utils/summary/validation/dashboard/dashboard_app.py</code></li> <li>Click \"Deploy\"</li> </ol>"},{"location":"validation-system/#step-3-configure-secrets-if-needed","title":"Step 3: Configure Secrets (if needed)","text":"<p>If using private data sources, add secrets in Streamlit Cloud:</p> <pre><code># .streamlit/secrets.toml\n[data_paths]\nmodel_runs = \"/path/to/data\"\n</code></pre>"},{"location":"validation-system/#server-deployment","title":"Server Deployment","text":"<p>For internal servers:</p> <pre><code># Run in background with nohup\nnohup streamlit run dashboard/dashboard_app.py \\\n  --server.port 8501 \\\n  --server.address 0.0.0.0 &amp;\n\n# Or use screen/tmux\nscreen -S dashboard\nstreamlit run dashboard/dashboard_app.py --server.port 8501\n# Ctrl+A, D to detach\n</code></pre>"},{"location":"validation-system/#8-frequently-asked-questions","title":"8. Frequently Asked Questions","text":""},{"location":"validation-system/#data-issues","title":"Data Issues","text":"<p>Q: \"Column not found\" error when generating summaries</p> <p>A: Check <code>data_model/ctramp_data_model.yaml</code> for correct column mappings:</p> <pre><code>individual_trips:\n  columns:\n    trip_mode: \"trip_mode\"  # Match actual CTRAMP column name\n</code></pre> <p>Q: Summary CSV is empty</p> <p>A: Check filters and data availability: - Verify input directory path in <code>validation_config.yaml</code> - Check if CTRAMP files exist and contain data - Review any <code>filters</code> in summary definition</p> <p>Q: Shares don't sum to 100%</p> <p>A: Check <code>share_within</code> parameter:</p> <pre><code># Shares within each purpose sum to 100%\nshare_within: \"tour_purpose\"\n\n# Without share_within, shares across all rows sum to 100%\n</code></pre>"},{"location":"validation-system/#configuration-issues","title":"Configuration Issues","text":"<p>Q: How do I add a new column to summaries?</p> <p>A: Two steps: 1. Add to <code>ctramp_data_model.yaml</code>: <pre><code>individual_trips:\n  columns:\n    my_new_column: \"ctramp_column_name\"\n</code></pre></p> <ol> <li>Add label to <code>variable_labels.yaml</code>: <pre><code>my_new_column: \"My Column Label\"\n</code></pre></li> </ol> <p>Q: Can I use calculated fields?</p> <p>A: Yes, create them in preprocessing or custom summary logic:</p> <pre><code># Example: Speed calculation\ndf['speed_mph'] = df['trip_distance_miles'] / (df['trip_time_minutes'] / 60)\n</code></pre> <p>Then reference in summary: <pre><code>aggregations:\n  avg_speed:\n    column: \"speed_mph\"\n    agg: \"mean\"\n</code></pre></p>"},{"location":"validation-system/#dashboard-issues","title":"Dashboard Issues","text":"<p>Q: New dashboard tab doesn't appear</p> <p>A: Check: 1. File naming: Must be <code>dashboard-N-title.yaml</code> (with number) 2. Location: Must be in <code>dashboard/</code> directory, not <code>outputs/dashboard/</code> 3. YAML syntax: Validate with <code>python -c \"import yaml; yaml.safe_load(open('dashboard-N-title.yaml'))\"</code></p> <p>Q: Chart shows \"No data available\"</p> <p>A: Verify: 1. CSV file exists in <code>outputs/dashboard/</code> 2. <code>data_file</code> in YAML matches CSV filename exactly 3. CSV contains data (not empty) 4. Required columns exist in CSV</p> <p>Q: Categories in wrong order</p> <p>A: Use <code>category_orders</code>:</p> <pre><code>category_orders:\n  distance_bin: ['&lt;1mi', '1-3mi', '3-5mi', '5-10mi', '10-20mi']\n</code></pre>"},{"location":"validation-system/#performance-issues","title":"Performance Issues","text":"<p>Q: Summary generation takes too long</p> <p>A: Optimization strategies: 1. Generate only core summaries for quick checks: <pre><code>generate_summaries: \"core\"\n</code></pre></p> <ol> <li> <p>Process fewer model runs (comment out in <code>input_directories</code>)</p> </li> <li> <p>Use more specific filters to reduce data size</p> </li> </ol> <p>Q: Dashboard is slow</p> <p>A: Tips: 1. Limit number of facets (subplots) 2. Reduce number of model runs being compared 3. Pre-aggregate data more (fewer rows in CSV) 4. Consider using Parquet instead of CSV for large files</p>"},{"location":"validation-system/#comparison-issues","title":"Comparison Issues","text":"<p>Q: Model and observed data don't align in charts</p> <p>A: Ensure matching: 1. Column names: Model and observed must use same names 2. Categories: Mode names, purpose names must match exactly 3. Dataset column: Observed data must include <code>dataset</code> column</p> <p>Q: How do I compare to previous model version?</p> <p>A: Add as separate input directory:</p> <pre><code>input_directories:\n  - path: \"/model_runs/v05\"\n    label: \"TM2.2 v05\"\n\n  - path: \"/model_runs/v06\"\n    label: \"TM2.2 v06\"\n</code></pre> <p>Both will appear in same charts for side-by-side comparison.</p>"},{"location":"validation-system/#9-common-workflows","title":"9. Common Workflows","text":""},{"location":"validation-system/#workflow-1-quick-model-run-validation","title":"Workflow 1: Quick Model Run Validation","text":"<pre><code># 1. Point to new model run\n# Edit validation_config.yaml:\n#   input_directories:\n#     - path: \"C:/new_model_run\"\n#       label: \"Test Run\"\n\n# 2. Generate core summaries only (fast)\n# Edit validation_config.yaml:\n#   generate_summaries: \"core\"\n\n# 3. Run and deploy\npython run_and_deploy_dashboard.py \\\n  --config validation_config.yaml \\\n  --launch-dashboard\n\n# 4. Review dashboard at http://localhost:8501\n</code></pre>"},{"location":"validation-system/#workflow-2-adding-new-observed-data","title":"Workflow 2: Adding New Observed Data","text":"<pre><code># 1. Preprocess observed data to match model format\npython preprocess_acs_data.py\n\n# 2. Add to validation_config.yaml:\n#   observed_data_sources:\n#     - name: \"ACS 2021\"\n#       directory: \"C:/data/acs_2021\"\n#       files:\n#         auto_ownership: \"acs_auto.csv\"\n\n# 3. Reference in existing summary:\n#   custom_summaries:\n#     - name: \"auto_ownership_regional\"\n#       observed_data: \"ACS 2021\"\n#       observed_file: \"auto_ownership\"\n\n# 4. Regenerate summaries\npython -m tm2py_utils.summary.validation.summaries.run_all \\\n  --config validation_config.yaml\n</code></pre>"},{"location":"validation-system/#workflow-3-creating-complete-new-analysis","title":"Workflow 3: Creating Complete New Analysis","text":"<pre><code># 1. Define summary in validation_config.yaml\n# 2. Test generation\npython -m tm2py_utils.summary.validation.summaries.run_all \\\n  --config validation_config.yaml \\\n  --summary-name my_new_summary\n\n# 3. Create dashboard YAML\n# dashboard/dashboard-9-my-analysis.yaml\n\n# 4. Deploy\npython run_and_deploy_dashboard.py \\\n  --config validation_config.yaml \\\n  --launch-dashboard\n</code></pre>"},{"location":"validation-system/#system-architecture","title":"System Architecture","text":""},{"location":"validation-system/#summary-file-generation","title":"Summary File Generation","text":"<p>The validation system generates two types of CSV files for each summary:</p> <ol> <li>Per-Dataset Files: One file per input directory with dataset name in filename</li> <li>Example: <code>cdap_by_share_2023 TM2.2 v05.csv</code>, <code>cdap_by_share_2015 TM2.2 Sprint 04.csv</code></li> <li>Contains data for single model run only</li> <li> <p>Useful for debugging and individual analysis</p> </li> <li> <p>Combined Files: Single file merging all datasets with <code>dataset</code> column</p> </li> <li>Example: <code>cdap_by_share.csv</code> (contains rows for all datasets)</li> <li>Used by dashboard for multi-run comparisons</li> <li>Generated automatically in <code>save_summaries()</code> function</li> </ol> <p>File locations: - <code>outputs/</code> - All generated CSV files (both types) - <code>outputs/dashboard/</code> - Copy of all files for dashboard use - <code>summary_index.csv</code> - Metadata catalog of all generated summaries</p>"},{"location":"validation-system/#how-summary-combination-works","title":"How Summary Combination Works","text":"<p>When you have multiple model runs configured (e.g., base year and plan year), the system:</p> <ol> <li>Generates individual summary for each dataset</li> <li>Groups summaries by base name (removes dataset suffix)</li> <li>Concatenates DataFrames and adds <code>dataset</code> column</li> <li>Saves combined file without dataset suffix</li> </ol> <p>Example: <pre><code># Generated files:\ncdap_by_share_2023 TM2.2 v05.csv      # 3 rows (H, M, N)\ncdap_by_share_2015 TM2.2 Sprint 04.csv  # 3 rows (H, M, N)\n\n# Combined automatically:\ncdap_by_share.csv                     # 6 rows (3 per dataset)\n</code></pre></p>"},{"location":"validation-system/#dashboard-integration","title":"Dashboard Integration","text":"<p>Dashboard YAML files reference the combined files (without dataset suffix):</p> <pre><code>charts:\n  - type: bar\n    dataset: cdap_by_share.csv  # Combined file\n    x: cdap\n    y: share\n    color: dataset  # Splits bars by model run\n</code></pre> <p>The <code>facet: dataset</code> or <code>color: dataset</code> parameter creates side-by-side comparisons.</p>"},{"location":"validation-system/#troubleshooting","title":"Troubleshooting","text":""},{"location":"validation-system/#summary-not-generating","title":"Summary Not Generating","text":"<p>Check 1: Required columns exist in data</p> <p>Some summaries require columns that must be derived or joined from other sources:</p> <pre><code># Example: This will FAIL if person data doesn't have age_category\n- name: \"cdap_by_age\"\n  group_by: [\"cdap\", \"age_category\"]  # \u274c age_category doesn't exist\n</code></pre> <p>Solutions: - Check <code>personData_1.csv</code> columns: <code>python -c \"import pandas as pd; print(pd.read_csv('personData_1.csv', nrows=1).columns.tolist())\"</code> - Derive needed columns in data preprocessing - Comment out summary in <code>validation_config.yaml</code> if not feasible</p> <p>Check 2: Data source file exists</p> <pre><code># This fails if wsLocResults.csv is missing\n- name: \"journey_to_work\"\n  data_source: \"workplace_school\"  # Requires wsLocResults.csv\n</code></pre> <p>Check 3: Review summary_index.csv</p> <pre><code># See what actually generated\ncat outputs/dashboard/summary_index.csv | grep \"your_summary_name\"\n</code></pre>"},{"location":"validation-system/#dashboard-shows-no-data","title":"Dashboard Shows No Data","text":"<p>Symptom: Chart area is blank or shows \"No data\"</p> <p>Common causes:</p> <ol> <li> <p>CSV file doesn't exist <pre><code># Check if file exists\nls outputs/dashboard/cdap_by_share.csv\n</code></pre></p> </li> <li> <p>Column names don't match <pre><code># Dashboard expects 'cdap' but CSV has 'cdap_pattern'\ncharts:\n  - x: cdap  # \u274c Column not found\n</code></pre></p> </li> <li> <p>Wrong file referenced (per-dataset instead of combined)    <pre><code># Wrong:\ndataset: cdap_by_share_2023 TM2.2 v05.csv\n\n# Right:\ndataset: cdap_by_share.csv\n</code></pre></p> </li> </ol> <p>Debug steps: <pre><code># Check CSV structure\npython -c \"import pandas as pd; df = pd.read_csv('outputs/dashboard/cdap_by_share.csv'); print(df.columns); print(df.head())\"\n</code></pre></p>"},{"location":"validation-system/#known-limitations","title":"Known Limitations","text":"<p>Disabled Summaries (commented out in <code>validation_config.yaml</code>):</p> Summary Issue Solution Required <code>cdap_by_age</code> Needs <code>age_category</code> column Derive from <code>age</code> (e.g., &lt;18, 18-64, 65+) <code>cdap_by_home_county</code> Needs <code>county_name</code> column Join household geography or derive from MAZ <code>cdap_by_auto_ownership</code> Needs <code>num_vehicles</code> from household Join person to household data <code>journey_to_work</code> <code>workplace_school</code> data not loading Fix <code>wsLocResults.csv</code> data loading <code>journey_to_work_by_mode</code> <code>workplace_school</code> data not loading Fix <code>wsLocResults.csv</code> data loading <p>To enable these summaries: 1. Implement required data derivation/joins 2. Uncomment summary configuration in <code>validation_config.yaml</code> 3. Update dashboard YAML if needed 4. Test generation and verify output</p>"},{"location":"validation-system/#additional-resources","title":"Additional Resources","text":"<ul> <li>Configuration Reference - Complete YAML syntax</li> <li>Dashboard Guide - Chart types and options</li> <li>Summary Generation - Aggregation and filtering</li> <li>Contributing Guide - Adding features</li> <li>Consolidation Proposal - System architecture</li> </ul>"},{"location":"validation-system/#support","title":"Support","text":"<ul> <li>Issues: https://github.com/BayAreaMetro/tm2py-utils/issues</li> <li>Email: modeling@bayareametro.gov</li> <li>Documentation: https://bayareametro.github.io/tm2py-utils/</li> </ul>"}]}